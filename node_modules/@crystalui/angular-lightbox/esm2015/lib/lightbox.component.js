/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, EventEmitter, HostBinding, HostListener, ViewChild, ElementRef, ChangeDetectorRef } from '@angular/core';
import { EventService } from './event.service';
import { LightboxCommonComponent } from './lightbox-common.component';
export class LightboxComponent extends LightboxCommonComponent {
    /**
     * @param {?} elementRef
     * @param {?} ref
     * @param {?} eventService
     */
    constructor(elementRef, ref, eventService) {
        super(eventService);
        this.elementRef = elementRef;
        this.ref = ref;
        this.eventService = eventService;
        this.spinnerHeight = 30;
        this.minTimeout = 30;
        this.preloaderTimeout = 100;
        this.spinnerStyles = {
            transform: ''
        };
        this.configThumbnailPreloader = true;
        this.events = new EventEmitter();
        this.hostShown = false;
        this.hideControls = false;
    }
    /**
     * @return {?}
     */
    get simpleMode() {
        return this.properties.simpleMode;
    }
    /**
     * @return {?}
     */
    get hostLightTheme() {
        return this.properties.backgroundColor === 'white';
    }
    /**
     * @return {?}
     */
    get currImagePath() {
        /** @type {?} */
        let image = this.images[this.index];
        /** @type {?} */
        let path;
        if (!image) {
            return false;
        }
        if (image.fullImage && image.fullImage.path) {
            path = image.fullImage.path;
        }
        else if (image.thumbnailImage && image.thumbnailImage.path) {
            path = image.thumbnailImage.path;
        }
        else if (image.path) {
            path = image.path;
        }
        return path;
    }
    /**
     * @return {?}
     */
    get prevImagePath() {
        return this.images[this.prevIndex];
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set prevImagePath(value) {
        this.images[this.prevIndex] = value;
    }
    /**
     * @return {?}
     */
    get isHiddenPrevArrow() {
        return this.isFirstImage && !this.properties.loop || this.isZoomIn;
    }
    /**
     * @return {?}
     */
    get isHiddenNextArrow() {
        return this.isLastImage && !this.properties.loop || this.isZoomIn;
    }
    /**
     * @return {?}
     */
    get isPreloader() {
        return this.animationMode === 'zoom-preloader' &&
            this.showState != 'animation-end' &&
            this.currImageLoadingState === 'loading';
    }
    /**
     * @return {?}
     */
    get imageOrientation() {
        if (this.thumbnailImage.naturalWidth > this.thumbnailImage.naturalHeight) {
            return 'horizontal';
        }
        else {
            return 'vertical';
        }
    }
    /**
     * @return {?}
     */
    scrolling() {
        if (this.showState === 'initial-thumbnail-image' ||
            this.showState === 'initial-virtual-image' ||
            this.closingState === 'animation') {
            this.updateThumbnailPosition();
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onKeyDown(event) {
        switch (event.key) {
            case 'ArrowLeft':
                this.prev();
                break;
            case 'ArrowRight':
                this.next();
                break;
            case 'Escape':
                this.closeLightbox();
                break;
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onMouseEnter(event) {
        this.hideControls = false;
    }
    /**
     * @param {?} event
     * @return {?}
     */
    transitionEnd(event) {
        if (event.propertyName === "transform" && this.hostAnimation) {
            this.hostAnimation = false;
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.currentImageIndex = this.properties.index;
        this.initialLightbox();
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        setTimeout((/**
         * @return {?}
         */
        () => {
            if (this.currImageLoadingState === 'not-loaded') {
                this.currImageLoadingState = 'loading';
            }
        }), this.preloaderTimeout);
        // Mode: default
        if (this.animationMode === 'default') {
            setTimeout((/**
             * @return {?}
             */
            () => {
                this.showLightboxAnimation();
            }), this.minTimeout);
        }
    }
    /**
     * @return {?}
     */
    onImageLoaded() {
        // When opening lightbox
        if (this.animationMode === 'zoom-preloader' &&
            this.showState === 'initial-thumbnail-image') {
            this.initialLightboxVirtualImage();
            setTimeout((/**
             * @return {?}
             */
            () => {
                this.currImageLoadingState = 'uploaded';
                this.showLightboxAnimation();
                if (this.properties.hideThumbnail) {
                    this.hideThumbnailImage();
                }
            }), this.minTimeout);
        }
        // When opening next / previous image
        if (this.showState === 'animation-end') {
            this.currImageLoadingState = 'uploaded';
            if (this.properties.hideThumbnail) {
                this.hideThumbnailImage();
            }
        }
        this.ref.detectChanges();
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onImageError(event) {
        this.currImageLoadingState = 'error';
        this.initialLightboxDefault();
        setTimeout((/**
         * @return {?}
         */
        () => {
            this.showLightboxAnimation();
        }), this.minTimeout);
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onContainerClick(event) {
        if (event.target === this.lightboxContainerElem.nativeElement || this.simpleMode) {
            this.closeLightbox();
        }
    }
    /**
     * @return {?}
     */
    initialLightbox() {
        this.setMaxDimensions();
        this.setAnimationDuration();
        switch (this.animationMode) {
            case 'zoom-preloader':
                this.initialLightboxThumbnailImage();
                break;
            case 'default':
                this.initialLightboxDefault();
                break;
        }
    }
    /**
     * @return {?}
     */
    initialLightboxDefault() {
        this.showState = 'initial-default';
        this.containerStyles = {
            transform: 'translate3d(0, 0, 0)',
            height: '100%',
            width: '100%',
            opacity: '0'
        };
        // next step: AfterViewInit
    }
    /**
     * @return {?}
     */
    initialLightboxVirtualImage() {
        this.setShowState('initial-virtual-image');
        this.containerStyles = {
            transform: this.containerInitialPosition,
            height: this.virtualImageDimension.height + 'px',
            width: this.virtualImageDimension.width + 'px'
        };
        // next step: onImageLoaded() -> showLightboxAnimation()
    }
    /**
     * @return {?}
     */
    initialLightboxThumbnailImage() {
        this.setShowState('initial-thumbnail-image');
        this.containerStyles = {
            transform: this.containerInitialPosition,
            height: this.thumbnailImagePosition.height + 'px',
            width: this.thumbnailImagePosition.width + 'px'
        };
        // next step: onImageLoaded()
    }
    /**
     * @return {?}
     */
    showLightboxAnimation() {
        this.hostAnimation = true;
        this.setShowState('animation');
        this.hostShown = true;
        this.setBackgroundColor();
        this.setAnimationDuration();
        // Mode: zoom preloader
        if (this.animationMode === 'zoom-preloader' &&
            this.currImageLoadingState !== 'error') {
            this.containerStyles.transform = this.containerFullscreenPosition;
        }
        // Mode: default
        if (this.animationMode === 'default') {
            this.containerStyles.opacity = '1';
        }
        // next step: handleLightboxTransitionEnd
    }
    /**
     * @return {?}
     */
    showLightboxAnimationEnd() {
        this.setShowState('animation-end');
        this.containerStyles = {
            transform: 'translate3d(0, 0, 0)',
            height: '100%',
            width: '100%',
        };
    }
    /**
     * @return {?}
     */
    closeLightbox() {
        this.setClosingState('initial');
        this.hostShown = false;
        this.closeLightboxInitial();
    }
    /**
     * @return {?}
     */
    closeLightboxInitial() {
        this.setClosingState('initial-styles');
        // Mode: zoom preloader
        if (this.animationMode === 'zoom-preloader') {
            this.containerStyles = {
                transform: this.containerFullscreenPosition,
                height: this.virtualImageDimension.height + 'px',
                width: this.virtualImageDimension.width + 'px',
            };
        }
        // Mode: default
        if (this.animationMode === 'default') {
            this.containerStyles.opacity = '1';
        }
        setTimeout((/**
         * @return {?}
         */
        () => {
            this.closeLightboxAnimation();
        }), this.minTimeout);
    }
    /**
     * @return {?}
     */
    closeLightboxAnimation() {
        this.setClosingState('animation');
        // Mode: zoom preloader
        if (this.animationMode === 'zoom-preloader') {
            this.hostAnimation = true;
            this.containerStyles = {
                transform: this.containerInitialPosition,
                height: this.getContainerHeight(),
                width: this.getContainerWidth(),
            };
            this.hostStyleBackgroundColor = '';
        }
        // Mode: default
        if (this.animationMode === 'default') {
            this.hostAnimation = true;
            this.containerStyles.opacity = '0';
            this.hostStyleBackgroundColor = '';
        }
        this.setAnimationDuration();
        // next step: handleLightboxTransitionEnd
        if (this.animationDuration === 0) { // in the future, change to a type conversion getter
            this.closeLightboxAnimationEnd();
        }
    }
    /**
     * @return {?}
     */
    closeLightboxAnimationEnd() {
        this.setClosingState('animation-end');
        this.events.emit({ type: 'close' });
        // Mode: zoom preloader
        if (this.animationMode === 'zoom-preloader') {
            this.showThumbnailImage();
        }
    }
    /*
         * Transition End
         */
    /**
     * @param {?} event
     * @return {?}
     */
    handleLightboxTransitionEnd(event) {
        if (this.showState === 'animation') {
            this.showLightboxAnimationEnd();
        }
        // Last close step
        if (this.closingState === 'animation') {
            this.closeLightboxAnimationEnd();
        }
    }
    /**
     * @return {?}
     */
    next() {
        if (this.animationMode === 'zoom-preloader') {
            this.showThumbnailImage();
        }
        if (this.isLastImage) {
            if (this.properties.loop) {
                this.currentImageIndex = 0;
            }
            else {
                return;
            }
        }
        else {
            this.currentImageIndex++;
            this.currImageLoadingState = 'loading';
        }
        setTimeout((/**
         * @return {?}
         */
        () => {
            if (this.currImageLoadingState !== 'uploaded') {
                this.currImageLoadingState = 'loading';
            }
        }), this.preloaderTimeout);
    }
    /**
     * @return {?}
     */
    prev() {
        if (this.animationMode === 'zoom-preloader') {
            this.showThumbnailImage();
        }
        if (this.isFirstImage) {
            if (this.properties.loop) {
                this.currentImageIndex = this.latestImageIndex;
            }
            else {
                return;
            }
        }
        else {
            this.currentImageIndex--;
            this.currImageLoadingState = 'loading';
        }
        setTimeout((/**
         * @return {?}
         */
        () => {
            if (this.currImageLoadingState !== 'uploaded') {
                this.currImageLoadingState = 'loading';
            }
        }), this.preloaderTimeout);
    }
    /**
     * @return {?}
     */
    setMaxDimensions() {
        this.lightboxImage.nativeElement.style.maxHeight = 'calc(' + this.properties.imageMaxHeight + ')';
        this.lightboxImage.nativeElement.style.maxWidth = this.properties.imageMaxWidth;
    }
    /**
     * @param {?} event
     * @return {?}
     */
    handlePinchZoomEvents(event) {
        if (event.type === "zoom-in") {
            this.isZoomIn = true;
        }
        if (event.type === "zoom-out") {
            this.isZoomIn = false;
        }
    }
    /**
     * @return {?}
     */
    getContainerWidth() {
        return this.thumbnailImagePosition.width / this.containerScale + 'px';
    }
}
LightboxComponent.decorators = [
    { type: Component, args: [{
                selector: 'crystal-lightbox',
                template: "<div class=\"lightbox-counter\" *ngIf=\"properties.counter && images.length > 1\">{{counter}}</div>\n<div class=\"lightbox-close\" *ngIf=\"!simpleMode\" (click)=\"closeLightbox()\">{{closeButtonText}}</div>\n<div class=\"lightbox-spinner\" \n\t*ngIf=\"currImageLoadingState === 'loading' && showState === 'animation-end'\"></div>\n<div class=\"lightbox-container\" \n\t#lightboxContainer\n\t[ngStyle]=\"containerStyles\"\n\t(transitionend)=\"handleLightboxTransitionEnd($event)\"\n\t(click)=\"onContainerClick($event)\">\n\n\t<div class=\"lightbox-preloader\" *ngIf=\"isPreloader\">\n\t\t<div class=\"lightbox-spinner\"></div>\n\t</div>\n\n\t<div class=\"lightbox-error\" *ngIf=\"currImageLoadingState === 'error' && !closingState\">Failed to load image</div>\n\n\t<img class=\"lightbox-curr-image\" \n\t\t#lightboxImage\n\t\t[src]=\"currImagePath\" \n\t\t[class.lightbox-show]=\"currImageLoadingState === 'uploaded'\" \n\t\t(load)=\"onImageLoaded()\"\n\t\t(error)=\"onImageError($event)\" />\n</div>\n\n<div class=\"lightbox-prev\" [hidden]=\"isHiddenPrevArrow\" (click)=\"prev()\"></div>\n<div class=\"lightbox-next\" [hidden]=\"isHiddenNextArrow\" (click)=\"next()\"></div>",
                styles: [".lightbox-spinner,.lightbox-spinner:after,.lightbox-spinner:before{border-radius:50%;width:10px;height:10px;-webkit-animation:1.5s ease-in-out infinite lightbox-load;animation:1.5s ease-in-out infinite lightbox-load}.lightbox-spinner{color:#fff;font-size:10px;margin:0 auto 20px;position:relative;text-indent:-9999em;-webkit-transform:translateZ(0);transform:translateZ(0);-webkit-animation-delay:-.16s;animation-delay:-.16s}.lightbox-spinner:after,.lightbox-spinner:before{content:'';position:absolute;top:0}.lightbox-spinner:before{left:-32px;-webkit-animation-delay:-.32s;animation-delay:-.32s}.lightbox-spinner:after{left:32px}@-webkit-keyframes lightbox-load{0%,100%,80%{box-shadow:0 2.5em 0 -1.3em}40%{box-shadow:0 2.5em 0 0}}@keyframes lightbox-load{0%,100%,80%{box-shadow:0 10px 0 -1.3em}40%{box-shadow:0 10px 0 0}}:host.lightbox-shown{opacity:1}:host.lightbox-shown .lightbox-close,:host.lightbox-shown .lightbox-next,:host.lightbox-shown .lightbox-prev{opacity:.5;transition-delay:.1s}:host.lightbox-shown .lightbox-close:hover,:host.lightbox-shown .lightbox-next:hover,:host.lightbox-shown .lightbox-prev:hover{opacity:1;transition-delay:0}:host.lightbox-shown .lightbox-counter{opacity:1}:host.lightbox-hide-controls .lightbox-close,:host.lightbox-hide-controls .lightbox-next,:host.lightbox-hide-controls .lightbox-prev{opacity:0}:host.lightbox-simple-mode .lightbox-container{cursor:zoom-out}:host:not(.lightbox-animation) .lightbox-container{display:flex;align-items:center;justify-content:center;top:0;left:0;height:100%}:host.lightbox-light{color:#000;text-shadow:none}:host{position:fixed;top:0;left:0;width:100%;height:100%;color:#fff;text-shadow:0 0 1px rgba(0,0,0,.65);-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;z-index:10000}:host img{opacity:1;max-width:100%;max-height:100%}:host img.lightbox-curr-image.lightbox-show{opacity:1}:host img.lightbox-curr-image{opacity:0;z-index:10}:host .lightbox-container.lightbox-hide{display:none}:host .lightbox-container{position:absolute;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-transform-origin:top left;transform-origin:top left}:host .lightbox-preloader{background:rgba(0,0,0,.4);display:flex;align-items:center;justify-content:center;width:100%;height:100%;position:absolute}:host .lightbox-spinner{position:absolute;top:51%;left:50%;margin-top:-15px;margin-left:-5px}:host .lightbox-preloader .lightbox-spinner{margin-top:-9px;margin-left:-3px}:host .lightbox-preloader .lightbox-spinner,:host .lightbox-preloader .lightbox-spinner:after,:host .lightbox-preloader .lightbox-spinner:before{width:6px;height:6px}:host .lightbox-preloader .lightbox-spinner:before{left:-21px}:host .lightbox-preloader .lightbox-spinner:after{left:21px}:host .lightbox-counter{text-align:left;position:absolute;left:22px;top:13px;font-size:14px;z-index:30}:host .lightbox-description{text-align:center;max-width:calc(100% - 200px);margin:0 auto;font-size:14px;line-height:43px;position:relative;z-index:50}:host .lightbox-error{color:rgba(255,255,255,.75);font-size:19px}:host .lightbox-close{position:absolute;top:0;right:0;padding:13px 22px;font-size:13px;text-transform:uppercase;cursor:pointer;opacity:.5;z-index:30;transition:opacity .1s ease-in-out}:host .lightbox-next,:host .lightbox-prev{width:100px;height:100%;position:absolute;top:0;cursor:pointer;opacity:.5;z-index:20;transition:opacity .1s ease-in-out;-webkit-tap-highlight-color:rgba(255,255,255,0)}:host .lightbox-prev{left:0;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAiCAYAAABbXymAAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTM4IDc5LjE1OTgyNCwgMjAxNi8wOS8xNC0wMTowOTowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTcgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjMzMTZCQzFERDgzMTExRTc5QUYxQTUxRDI5MkM5ODZCIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjMzMTZCQzFFRDgzMTExRTc5QUYxQTUxRDI5MkM5ODZCIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MzMxNkJDMUJEODMxMTFFNzlBRjFBNTFEMjkyQzk4NkIiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MzMxNkJDMUNEODMxMTFFNzlBRjFBNTFEMjkyQzk4NkIiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7VrwZKAAAClElEQVR42qzWSY8SQRgGYLoVHPeTXlwCiIwMArJGtiABNep4IGZi4oEfMJooLjePrnFGf5yJS0hYmq2b/aBxiQ6+lRRJdaUZq5vp5E2TLnioVFd9VZLN+iUxIdeMiW2fRVCmvz2DpJBVCk6X6SVBHQRLpVKb7Xb782g0Usrl8jM8W0P20+9YQn3JZPIhwN6MXoPBoI3nG8iKGZhF14A+AqrOmKtWq31F213kkOgQ69B0Ol0BqrFot9vV/H7/c7RfEoVZ1G+EdjqdvtfrfYn2K8gJkaHQodlstjIej/ssihdH0Ddov4acQo7QlycJo5PJhEc1j8fzmqJk2h1D7Lv1lkUv5nK5xzzaarWMUIcwms/nCTrgUbfbTdCrVtAAQafTqQ5VFEVdCi0UCk/Q0yGLNptN1el0vqLoaRHUxqPoKY/2KFo0g0r0ba4Wi8WnQEcs2mg0VAPULrJsZTqpNzDZ6yxar9dVl8tFVtR10SnFohJdgnZYuh9IkjSTZfknPn5DviO/kL/IjkgtIOhhJJ7JZF5gdU24hdDG6qqg/QJywEzlmg/FSTLhE4nE9nA4nHJFRvH5fJto94gOBfvyjtJxXI/H4x+A63re6/UUVDCCnzeDz6fbceQscjsWi703wFsM7hDBJQN8PRqNbmNn0OGapu0JfoviYx4PBAL30e5dCg+Hw0Z4e8/wfr/P451QKPRgaRzIFjDdksefsbjdKn5zER6JRMiwuP+3Ne2KB4PBLVVVR1xd+YK2O2bOFYvwd8CHbK/x/J6Zc8Ui/AZmxdtqtdrAwlFLpRLZrS/PYcnkEUuiY7hCS+g5sovT55+Qj7QS/jYD8zjp/UF6t9GS+oPed8zCLC5zJ0tSo//Q+8wKLHTw/ifAAMQVS4vHZR2VAAAAAElFTkSuQmCC) center left 22px no-repeat}:host .lightbox-next{right:0;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAiCAYAAABbXymAAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTM4IDc5LjE1OTgyNCwgMjAxNi8wOS8xNC0wMTowOTowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTcgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjEyNDE3MDE1RDgzMTExRTc5NjM4QTIzQzI2Rjc2Qjg2IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjEyNDE3MDE2RDgzMTExRTc5NjM4QTIzQzI2Rjc2Qjg2Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MTI0MTcwMTNEODMxMTFFNzk2MzhBMjNDMjZGNzZCODYiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MTI0MTcwMTREODMxMTFFNzk2MzhBMjNDMjZGNzZCODYiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7zv5BKAAACl0lEQVR42rTW224SQRwGcHZb8FT1Sm88BJCiFAE5JpyCBNRE8coYEy94AGqi9XDXS0+JVh/CB/EhiFET5LjAclgWjaa1aazfJDM6u6LuLjrJl2124cd0duY/I9h+NoELabtcTLcFCon0bw+SRE4h28hn2xyNoIvISrlcfqAoSluSpLepVKqCe6cRB/2MYAXei1wfjUbSLm34gX4ymbyN+z6rOBmC/ciNer3+fpdrwGXgd8h/YwVn8Dm/37/e6/UGOnyQTqfXrOBsKI4g571e76Nutzv8De43gwv05S0hx5CLwJ/iBWrwyWQyzGazpnHyITtyCDlBcI/H8wS4ZlhUVbWMO/R4p9P5Bc/lcnfx/Ow8+AW32z0LH+Xz+X+Dt9ttmcen0ynDA1bx4wR3Op2PW62WrOv5uFAo3JsXL1K8r+v5LNxmZrb8wJvNpn5YlGKxeJ/WFruZBcRPxUsul2u90WhocCyqBqk3dLGJiwbgb/T6FflCSqkoiluCIGjqNGzWgQUz9YR8aQ9yBqtyDQtH0q1KNZPJPMTzOHKA4oaHwuPz+SooUm0eHY/H00QisUEWFHKUDYVRdBmVr9Lv9/WoGo/HX+J5iY7/QSMvj003hnb0aCwWe4HnV5GTyGEj002DDgYDDYqdRo1Goxu0p3pU+BvqDQQCqzPQCUWvzINKejQcDltHQ6HQLaBdHh0Oh5ZRO0OBaFD8iIL7z82ibGtyRyKR1T+gl82g/GZ6Dev/HY/KsqwEg0FLKL/93+R7C3QM9Nk8KDtiOWq12jb2s2XS01Kp9Kparb7G/TfIR2QT2TF6UBS42bBEi/UK/SIBPyCfkC0zKA+z6rWPXm30tLlJr6ZQ/ZmYDYnI1eEdejV9Thb+18H7uwADAOG/Wcm4x+knAAAAAElFTkSuQmCC) center right 22px no-repeat}:host .lightbox-close,:host .lightbox-counter,:host .lightbox-next,:host .lightbox-prev{opacity:0;transition:opacity 150ms cubic-bezier(.475,.105,.445,.945)}"]
            }] }
];
/** @nocollapse */
LightboxComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: ChangeDetectorRef },
    { type: EventService }
];
LightboxComponent.propDecorators = {
    hostShown: [{ type: HostBinding, args: ['class.lightbox-shown',] }],
    hideControls: [{ type: HostBinding, args: ['class.lightbox-hide-controls',] }],
    hostAnimation: [{ type: HostBinding, args: ['class.lightbox-animation',] }],
    simpleMode: [{ type: HostBinding, args: ['class.lightbox-simple-mode',] }],
    hostLightTheme: [{ type: HostBinding, args: ['class.lightbox-light',] }],
    hostStyleBackgroundColor: [{ type: HostBinding, args: ['style.backgroundColor',] }],
    prevImageElem: [{ type: ViewChild, args: ['prevImageElem',] }],
    lightboxContainerElem: [{ type: ViewChild, args: ['lightboxContainer',] }],
    scrolling: [{ type: HostListener, args: ['window:scroll',] }],
    onKeyDown: [{ type: HostListener, args: ['window:keydown', ['$event'],] }],
    onMouseEnter: [{ type: HostListener, args: ["mouseenter", ['$event'],] }],
    transitionEnd: [{ type: HostListener, args: ['transitionend', ['$event'],] }]
};
if (false) {
    /** @type {?} */
    LightboxComponent.prototype.prevIndex;
    /** @type {?} */
    LightboxComponent.prototype.spinnerHeight;
    /** @type {?} */
    LightboxComponent.prototype.isZoomIn;
    /** @type {?} */
    LightboxComponent.prototype.minTimeout;
    /** @type {?} */
    LightboxComponent.prototype.preloaderTimeout;
    /** @type {?} */
    LightboxComponent.prototype.spinnerStyles;
    /** @type {?} */
    LightboxComponent.prototype.configThumbnailPreloader;
    /** @type {?} */
    LightboxComponent.prototype.events;
    /** @type {?} */
    LightboxComponent.prototype.hostShown;
    /** @type {?} */
    LightboxComponent.prototype.hideControls;
    /** @type {?} */
    LightboxComponent.prototype.hostAnimation;
    /** @type {?} */
    LightboxComponent.prototype.hostStyleBackgroundColor;
    /** @type {?} */
    LightboxComponent.prototype.prevImageElem;
    /** @type {?} */
    LightboxComponent.prototype.lightboxContainerElem;
    /**
     * @type {?}
     * @private
     */
    LightboxComponent.prototype.elementRef;
    /**
     * @type {?}
     * @private
     */
    LightboxComponent.prototype.ref;
    /** @type {?} */
    LightboxComponent.prototype.eventService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlnaHRib3guY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGNyeXN0YWx1aS9hbmd1bGFyLWxpZ2h0Ym94LyIsInNvdXJjZXMiOlsibGliL2xpZ2h0Ym94LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBUyxZQUFZLEVBQVUsV0FBVyxFQUFFLFlBQVksRUFBRSxTQUFTLEVBQWdCLFVBQVUsRUFBRSxpQkFBaUIsRUFBOEIsTUFBTSxlQUFlLENBQUM7QUFHdEwsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQy9DLE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBUXRFLE1BQU0sT0FBTyxpQkFBa0IsU0FBUSx1QkFBdUI7Ozs7OztJQWdIMUQsWUFDWSxVQUFzQixFQUN0QixHQUFzQixFQUN2QixZQUEwQjtRQUNqQyxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUM7UUFIWixlQUFVLEdBQVYsVUFBVSxDQUFZO1FBQ3RCLFFBQUcsR0FBSCxHQUFHLENBQW1CO1FBQ3ZCLGlCQUFZLEdBQVosWUFBWSxDQUFjO1FBakhyQyxrQkFBYSxHQUFXLEVBQUUsQ0FBQztRQUUzQixlQUFVLEdBQVcsRUFBRSxDQUFDO1FBQ3hCLHFCQUFnQixHQUFXLEdBQUcsQ0FBQztRQUMvQixrQkFBYSxHQUFRO1lBQ2pCLFNBQVMsRUFBRSxFQUFFO1NBQ2hCLENBQUM7UUFDRiw2QkFBd0IsR0FBRyxJQUFJLENBQUM7UUFDaEMsV0FBTSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFFUyxjQUFTLEdBQVksS0FBSyxDQUFDO1FBQ25CLGlCQUFZLEdBQVksS0FBSyxDQUFDO0lBd0czRSxDQUFDOzs7O0lBdEdELElBQ0ksVUFBVTtRQUNWLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxVQUFVLENBQUM7SUFDdEMsQ0FBQzs7OztJQUVELElBQXlDLGNBQWM7UUFDbkQsT0FB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SUFDMUUsQ0FBQzs7O1lBclpKLFNBQVMsU0FBQztnQkFDUCxRQUFRLEVBQUUsa0JBQWtCO2dCQUM1QixvcUNBQXdDOzthQUUzQzs7OztZQVZvRyxVQUFVO1lBQUUsaUJBQWlCO1lBR3pILFlBQVk7Ozt3QkFxQmhCLFdBQVcsU0FBQyxzQkFBc0I7MkJBQ2xDLFdBQVcsU0FBQyw4QkFBOEI7NEJBQzFDLFdBQVcsU0FBQywwQkFBMEI7eUJBQ3RDLFdBQVcsU0FBQyw0QkFBNEI7NkJBS3hDLFdBQVcsU0FBQyxzQkFBc0I7dUNBSWxDLFdBQVcsU0FBQyx1QkFBdUI7NEJBRW5DLFNBQVMsU0FBQyxlQUFlO29DQUN6QixTQUFTLFNBQUMsbUJBQW1CO3dCQWtEN0IsWUFBWSxTQUFDLGVBQWU7d0JBUTVCLFlBQVksU0FBQyxnQkFBZ0IsRUFBRSxDQUFDLFFBQVEsQ0FBQzsyQkFlekMsWUFBWSxTQUFDLFlBQVksRUFBRSxDQUFDLFFBQVEsQ0FBQzs0QkFLckMsWUFBWSxTQUFDLGVBQWUsRUFBRSxDQUFDLFFBQVEsQ0FBQzs7OztJQXhHekMsc0NBQWtCOztJQUNsQiwwQ0FBMkI7O0lBQzNCLHFDQUFrQjs7SUFDbEIsdUNBQXdCOztJQUN4Qiw2Q0FBK0I7O0lBQy9CLDBDQUVFOztJQUNGLHFEQUFnQzs7SUFDaEMsbUNBQTRCOztJQUU1QixzQ0FBZ0U7O0lBQ2hFLHlDQUEyRTs7SUFDM0UsMENBQWdFOztJQVVoRSxxREFBdUU7O0lBRXZFLDBDQUFzRDs7SUFDdEQsa0RBQWtFOzs7OztJQXNGOUQsdUNBQThCOzs7OztJQUM5QixnQ0FBOEI7O0lBQzlCLHlDQUFpQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIEV2ZW50RW1pdHRlciwgT25Jbml0LCBIb3N0QmluZGluZywgSG9zdExpc3RlbmVyLCBWaWV3Q2hpbGQsIFZpZXdDaGlsZHJlbiwgRWxlbWVudFJlZiwgQ2hhbmdlRGV0ZWN0b3JSZWYsIENvbnRlbnRDaGlsZHJlbiwgUXVlcnlMaXN0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBMaWdodGJveERhdGEgfSBmcm9tICcuL2ludGVyZmFjZXMnO1xuaW1wb3J0IHsgU2hvd1N0YXRlLCBDbG9zaW5nU3RhdGUgfSBmcm9tICcuL3R5cGVzJztcbmltcG9ydCB7IEV2ZW50U2VydmljZSB9IGZyb20gJy4vZXZlbnQuc2VydmljZSc7XG5pbXBvcnQgeyBMaWdodGJveENvbW1vbkNvbXBvbmVudCB9IGZyb20gJy4vbGlnaHRib3gtY29tbW9uLmNvbXBvbmVudCc7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnY3J5c3RhbC1saWdodGJveCcsXG4gICAgdGVtcGxhdGVVcmw6ICcuL2xpZ2h0Ym94LmNvbXBvbmVudC5odG1sJyxcbiAgICBzdHlsZVVybHM6IFsnLi9jc3MvbGlnaHRib3guY29tcG9uZW50LnNhc3MnXVxufSlcblxuZXhwb3J0IGNsYXNzIExpZ2h0Ym94Q29tcG9uZW50IGV4dGVuZHMgTGlnaHRib3hDb21tb25Db21wb25lbnQge1xuICAgIHByZXZJbmRleDogbnVtYmVyO1xuICAgIHNwaW5uZXJIZWlnaHQ6IG51bWJlciA9IDMwO1xuICAgIGlzWm9vbUluOiBib29sZWFuO1xuICAgIG1pblRpbWVvdXQ6IG51bWJlciA9IDMwO1xuICAgIHByZWxvYWRlclRpbWVvdXQ6IG51bWJlciA9IDEwMDtcbiAgICBzcGlubmVyU3R5bGVzOiBhbnkgPSB7XG4gICAgICAgIHRyYW5zZm9ybTogJydcbiAgICB9O1xuICAgIGNvbmZpZ1RodW1ibmFpbFByZWxvYWRlciA9IHRydWU7XG4gICAgZXZlbnRzID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gICAgQEhvc3RCaW5kaW5nKCdjbGFzcy5saWdodGJveC1zaG93bicpIGhvc3RTaG93bjogYm9vbGVhbiA9IGZhbHNlO1xuICAgIEBIb3N0QmluZGluZygnY2xhc3MubGlnaHRib3gtaGlkZS1jb250cm9scycpIGhpZGVDb250cm9sczogYm9vbGVhbiA9IGZhbHNlO1xuICAgIEBIb3N0QmluZGluZygnY2xhc3MubGlnaHRib3gtYW5pbWF0aW9uJykgaG9zdEFuaW1hdGlvbjogYm9vbGVhbjtcbiAgICBASG9zdEJpbmRpbmcoJ2NsYXNzLmxpZ2h0Ym94LXNpbXBsZS1tb2RlJylcbiAgICBnZXQgc2ltcGxlTW9kZSgpe1xuICAgICAgICByZXR1cm4gdGhpcy5wcm9wZXJ0aWVzLnNpbXBsZU1vZGU7XG4gICAgfVxuXG4gICAgQEhvc3RCaW5kaW5nKCdjbGFzcy5saWdodGJveC1saWdodCcpIGdldCBob3N0TGlnaHRUaGVtZSgpe1xuICAgICAgICByZXR1cm4gdGhpcy5wcm9wZXJ0aWVzLmJhY2tncm91bmRDb2xvciA9PT0gJ3doaXRlJztcbiAgICB9XG5cbiAgICBASG9zdEJpbmRpbmcoJ3N0eWxlLmJhY2tncm91bmRDb2xvcicpIGhvc3RTdHlsZUJhY2tncm91bmRDb2xvcjogc3RyaW5nO1xuXG4gICAgQFZpZXdDaGlsZCgncHJldkltYWdlRWxlbScpIHByZXZJbWFnZUVsZW06IEVsZW1lbnRSZWY7XG4gICAgQFZpZXdDaGlsZCgnbGlnaHRib3hDb250YWluZXInKSBsaWdodGJveENvbnRhaW5lckVsZW06IEVsZW1lbnRSZWY7XG5cbiAgICBnZXQgY3VyckltYWdlUGF0aCgpe1xuICAgICAgICBsZXQgaW1hZ2UgPSB0aGlzLmltYWdlc1t0aGlzLmluZGV4XTtcbiAgICAgICAgbGV0IHBhdGg7XG5cbiAgICAgICAgaWYgKCFpbWFnZSl7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaW1hZ2UuZnVsbEltYWdlICYmIGltYWdlLmZ1bGxJbWFnZS5wYXRoKXtcbiAgICAgICAgICAgIHBhdGggPSAgaW1hZ2UuZnVsbEltYWdlLnBhdGg7XG4gICAgICAgIH0gZWxzZSBpZiAoaW1hZ2UudGh1bWJuYWlsSW1hZ2UgJiYgaW1hZ2UudGh1bWJuYWlsSW1hZ2UucGF0aCkge1xuICAgICAgICAgICAgcGF0aCA9IGltYWdlLnRodW1ibmFpbEltYWdlLnBhdGg7XG4gICAgICAgIH0gZWxzZSBpZiAoaW1hZ2UucGF0aCl7XG4gICAgICAgICAgICBwYXRoID0gaW1hZ2UucGF0aDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBwYXRoO1xuICAgIH1cblxuICAgIGdldCBwcmV2SW1hZ2VQYXRoKCl7XG4gICAgICAgIHJldHVybiB0aGlzLmltYWdlc1t0aGlzLnByZXZJbmRleF07XG4gICAgfVxuXG4gICAgc2V0IHByZXZJbWFnZVBhdGgodmFsdWU6IGFueSl7XG4gICAgICAgIHRoaXMuaW1hZ2VzW3RoaXMucHJldkluZGV4XSA9IHZhbHVlO1xuICAgIH1cblxuICAgIGdldCBpc0hpZGRlblByZXZBcnJvdygpe1xuICAgICAgICByZXR1cm4gdGhpcy5pc0ZpcnN0SW1hZ2UgJiYgIXRoaXMucHJvcGVydGllcy5sb29wIHx8IHRoaXMuaXNab29tSW47XG4gICAgfVxuICAgIGdldCBpc0hpZGRlbk5leHRBcnJvdygpe1xuICAgICAgICByZXR1cm4gdGhpcy5pc0xhc3RJbWFnZSAmJiAhdGhpcy5wcm9wZXJ0aWVzLmxvb3AgfHwgdGhpcy5pc1pvb21JbjtcbiAgICB9XG5cbiAgICBnZXQgaXNQcmVsb2FkZXIoKXtcbiAgICAgICAgcmV0dXJuIHRoaXMuYW5pbWF0aW9uTW9kZSA9PT0gJ3pvb20tcHJlbG9hZGVyJyAmJiBcbiAgICAgICAgICAgdGhpcy5zaG93U3RhdGUgIT0gJ2FuaW1hdGlvbi1lbmQnICYmIFxuICAgICAgICAgICB0aGlzLmN1cnJJbWFnZUxvYWRpbmdTdGF0ZSA9PT0gJ2xvYWRpbmcnO1xuICAgIH1cblxuICAgIGdldCBpbWFnZU9yaWVudGF0aW9uKCk6J3ZlcnRpY2FsJyB8ICdob3Jpem9udGFsJyB7XG4gICAgICAgIGlmICh0aGlzLnRodW1ibmFpbEltYWdlLm5hdHVyYWxXaWR0aCA+IHRoaXMudGh1bWJuYWlsSW1hZ2UubmF0dXJhbEhlaWdodCl7XG4gICAgICAgICAgICByZXR1cm4gJ2hvcml6b250YWwnO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuICd2ZXJ0aWNhbCc7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBASG9zdExpc3RlbmVyKCd3aW5kb3c6c2Nyb2xsJykgc2Nyb2xsaW5nKCl7XG4gICAgICAgIGlmICh0aGlzLnNob3dTdGF0ZSA9PT0gJ2luaXRpYWwtdGh1bWJuYWlsLWltYWdlJyB8fFxuICAgICAgICAgICAgdGhpcy5zaG93U3RhdGUgPT09ICdpbml0aWFsLXZpcnR1YWwtaW1hZ2UnIHx8XG4gICAgICAgICAgICB0aGlzLmNsb3NpbmdTdGF0ZSA9PT0gJ2FuaW1hdGlvbicpe1xuICAgICAgICAgICAgdGhpcy51cGRhdGVUaHVtYm5haWxQb3NpdGlvbigpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgQEhvc3RMaXN0ZW5lcignd2luZG93OmtleWRvd24nLCBbJyRldmVudCddKVxuICAgIG9uS2V5RG93bihldmVudDogYW55KSB7XG4gICAgICAgIHN3aXRjaChldmVudC5rZXkpIHtcbiAgICAgICAgICAgIGNhc2UgJ0Fycm93TGVmdCc6XG4gICAgICAgICAgICAgICAgdGhpcy5wcmV2KCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdBcnJvd1JpZ2h0JzpcbiAgICAgICAgICAgICAgICB0aGlzLm5leHQoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ0VzY2FwZSc6XG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZUxpZ2h0Ym94KCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBASG9zdExpc3RlbmVyKFwibW91c2VlbnRlclwiLCBbJyRldmVudCddKVxuICAgIG9uTW91c2VFbnRlcihldmVudDogYW55KSB7XG4gICAgICAgIHRoaXMuaGlkZUNvbnRyb2xzID0gZmFsc2U7XG4gICAgfVxuXG4gICAgQEhvc3RMaXN0ZW5lcigndHJhbnNpdGlvbmVuZCcsIFsnJGV2ZW50J10pXG4gICAgdHJhbnNpdGlvbkVuZChldmVudCkge1xuICAgICAgICBpZiAoZXZlbnQucHJvcGVydHlOYW1lID09PSBcInRyYW5zZm9ybVwiICYmIHRoaXMuaG9zdEFuaW1hdGlvbil7XG4gICAgICAgICAgICB0aGlzLmhvc3RBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwcml2YXRlIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYsIFxuICAgICAgICBwcml2YXRlIHJlZjogQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gICAgICAgIHB1YmxpYyBldmVudFNlcnZpY2U6IEV2ZW50U2VydmljZSl7XG4gICAgICAgIHN1cGVyKGV2ZW50U2VydmljZSk7XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKXtcbiAgICAgICAgdGhpcy5jdXJyZW50SW1hZ2VJbmRleCA9IHRoaXMucHJvcGVydGllcy5pbmRleDtcbiAgICAgICAgdGhpcy5pbml0aWFsTGlnaHRib3goKTtcbiAgICB9XG5cbiAgICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuY3VyckltYWdlTG9hZGluZ1N0YXRlID09PSAnbm90LWxvYWRlZCcpe1xuICAgICAgICAgICAgICAgIHRoaXMuY3VyckltYWdlTG9hZGluZ1N0YXRlID0gJ2xvYWRpbmcnO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCB0aGlzLnByZWxvYWRlclRpbWVvdXQpO1xuXG4gICAgICAgIC8vIE1vZGU6IGRlZmF1bHRcbiAgICAgICAgaWYgKHRoaXMuYW5pbWF0aW9uTW9kZSA9PT0gJ2RlZmF1bHQnKXsgXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnNob3dMaWdodGJveEFuaW1hdGlvbigpO1xuICAgICAgICAgICAgfSwgdGhpcy5taW5UaW1lb3V0KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG9uSW1hZ2VMb2FkZWQoKXtcbiAgICAgICAgLy8gV2hlbiBvcGVuaW5nIGxpZ2h0Ym94XG4gICAgICAgIGlmICh0aGlzLmFuaW1hdGlvbk1vZGUgPT09ICd6b29tLXByZWxvYWRlcicgJiYgXG4gICAgICAgICAgICB0aGlzLnNob3dTdGF0ZSA9PT0gJ2luaXRpYWwtdGh1bWJuYWlsLWltYWdlJyl7XG4gICAgICAgICAgICB0aGlzLmluaXRpYWxMaWdodGJveFZpcnR1YWxJbWFnZSgpO1xuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJySW1hZ2VMb2FkaW5nU3RhdGUgPSAndXBsb2FkZWQnO1xuICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xpZ2h0Ym94QW5pbWF0aW9uKCk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucHJvcGVydGllcy5oaWRlVGh1bWJuYWlsKXtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5oaWRlVGh1bWJuYWlsSW1hZ2UoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCB0aGlzLm1pblRpbWVvdXQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gV2hlbiBvcGVuaW5nIG5leHQgLyBwcmV2aW91cyBpbWFnZVxuICAgICAgICBpZiAodGhpcy5zaG93U3RhdGUgPT09ICdhbmltYXRpb24tZW5kJyl7XG4gICAgICAgICAgICB0aGlzLmN1cnJJbWFnZUxvYWRpbmdTdGF0ZSA9ICd1cGxvYWRlZCc7XG4gICAgICAgICAgICBpZiAodGhpcy5wcm9wZXJ0aWVzLmhpZGVUaHVtYm5haWwpe1xuICAgICAgICAgICAgICAgIHRoaXMuaGlkZVRodW1ibmFpbEltYWdlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnJlZi5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgfVxuXG4gICAgb25JbWFnZUVycm9yKGV2ZW50KXtcbiAgICAgICAgdGhpcy5jdXJySW1hZ2VMb2FkaW5nU3RhdGUgPSAnZXJyb3InO1xuICAgICAgICB0aGlzLmluaXRpYWxMaWdodGJveERlZmF1bHQoKTtcblxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2hvd0xpZ2h0Ym94QW5pbWF0aW9uKCk7XG4gICAgICAgIH0sIHRoaXMubWluVGltZW91dCk7XG4gICAgfVxuXG4gICAgb25Db250YWluZXJDbGljayhldmVudCl7XG4gICAgICAgIGlmIChldmVudC50YXJnZXQgPT09IHRoaXMubGlnaHRib3hDb250YWluZXJFbGVtLm5hdGl2ZUVsZW1lbnQgfHwgdGhpcy5zaW1wbGVNb2RlKXtcbiAgICAgICAgICAgIHRoaXMuY2xvc2VMaWdodGJveCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaW5pdGlhbExpZ2h0Ym94KCl7XG4gICAgICAgIHRoaXMuc2V0TWF4RGltZW5zaW9ucygpO1xuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbkR1cmF0aW9uKCk7XG5cbiAgICAgICAgc3dpdGNoICh0aGlzLmFuaW1hdGlvbk1vZGUpIHtcbiAgICAgICAgICAgIGNhc2UgJ3pvb20tcHJlbG9hZGVyJzpcbiAgICAgICAgICAgICAgICB0aGlzLmluaXRpYWxMaWdodGJveFRodW1ibmFpbEltYWdlKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdkZWZhdWx0JzpcbiAgICAgICAgICAgICAgICB0aGlzLmluaXRpYWxMaWdodGJveERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGluaXRpYWxMaWdodGJveERlZmF1bHQoKXtcbiAgICAgICAgdGhpcy5zaG93U3RhdGUgPSAnaW5pdGlhbC1kZWZhdWx0JztcbiAgICAgICAgdGhpcy5jb250YWluZXJTdHlsZXMgPSB7XG4gICAgICAgICAgICB0cmFuc2Zvcm06ICd0cmFuc2xhdGUzZCgwLCAwLCAwKScsXG4gICAgICAgICAgICBoZWlnaHQ6ICcxMDAlJyxcbiAgICAgICAgICAgIHdpZHRoOiAnMTAwJScsXG4gICAgICAgICAgICBvcGFjaXR5OiAnMCdcbiAgICAgICAgfVxuICAgICAgICAvLyBuZXh0IHN0ZXA6IEFmdGVyVmlld0luaXRcbiAgICB9XG5cbiAgICBpbml0aWFsTGlnaHRib3hWaXJ0dWFsSW1hZ2UoKXtcbiAgICAgICAgdGhpcy5zZXRTaG93U3RhdGUoJ2luaXRpYWwtdmlydHVhbC1pbWFnZScpO1xuICAgICAgICB0aGlzLmNvbnRhaW5lclN0eWxlcyA9IHtcbiAgICAgICAgICAgIHRyYW5zZm9ybTogdGhpcy5jb250YWluZXJJbml0aWFsUG9zaXRpb24sXG4gICAgICAgICAgICBoZWlnaHQ6IHRoaXMudmlydHVhbEltYWdlRGltZW5zaW9uLmhlaWdodCArICdweCcsXG4gICAgICAgICAgICB3aWR0aDogdGhpcy52aXJ0dWFsSW1hZ2VEaW1lbnNpb24ud2lkdGggKyAncHgnXG4gICAgICAgIH1cbiAgICAgICAgLy8gbmV4dCBzdGVwOiBvbkltYWdlTG9hZGVkKCkgLT4gc2hvd0xpZ2h0Ym94QW5pbWF0aW9uKClcbiAgICB9XG5cbiAgICBpbml0aWFsTGlnaHRib3hUaHVtYm5haWxJbWFnZSgpe1xuICAgICAgICB0aGlzLnNldFNob3dTdGF0ZSgnaW5pdGlhbC10aHVtYm5haWwtaW1hZ2UnKTtcbiAgICAgICAgdGhpcy5jb250YWluZXJTdHlsZXMgPSB7XG4gICAgICAgICAgICB0cmFuc2Zvcm06IHRoaXMuY29udGFpbmVySW5pdGlhbFBvc2l0aW9uLFxuICAgICAgICAgICAgaGVpZ2h0OiB0aGlzLnRodW1ibmFpbEltYWdlUG9zaXRpb24uaGVpZ2h0ICsgJ3B4JyxcbiAgICAgICAgICAgIHdpZHRoOiB0aGlzLnRodW1ibmFpbEltYWdlUG9zaXRpb24ud2lkdGggKyAncHgnXG4gICAgICAgIH1cbiAgICAgICAgLy8gbmV4dCBzdGVwOiBvbkltYWdlTG9hZGVkKClcbiAgICB9XG5cbiAgICBzaG93TGlnaHRib3hBbmltYXRpb24oKXtcbiAgICAgICAgdGhpcy5ob3N0QW5pbWF0aW9uID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zZXRTaG93U3RhdGUoJ2FuaW1hdGlvbicpO1xuICAgICAgICB0aGlzLmhvc3RTaG93biA9IHRydWU7XG4gICAgICAgIHRoaXMuc2V0QmFja2dyb3VuZENvbG9yKCk7XG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uRHVyYXRpb24oKTtcbiAgICAgICAgXG4gICAgICAgIC8vIE1vZGU6IHpvb20gcHJlbG9hZGVyXG4gICAgICAgIGlmICh0aGlzLmFuaW1hdGlvbk1vZGUgPT09ICd6b29tLXByZWxvYWRlcicgJiZcbiAgICAgICAgICAgIHRoaXMuY3VyckltYWdlTG9hZGluZ1N0YXRlICE9PSAnZXJyb3InKXsgXG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lclN0eWxlcy50cmFuc2Zvcm0gPSB0aGlzLmNvbnRhaW5lckZ1bGxzY3JlZW5Qb3NpdGlvbjtcbiAgICAgICAgfSBcblxuICAgICAgICAvLyBNb2RlOiBkZWZhdWx0XG4gICAgICAgIGlmICh0aGlzLmFuaW1hdGlvbk1vZGUgPT09ICdkZWZhdWx0Jyl7XG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lclN0eWxlcy5vcGFjaXR5ID0gJzEnO1xuICAgICAgICB9XG4gICAgICAgIC8vIG5leHQgc3RlcDogaGFuZGxlTGlnaHRib3hUcmFuc2l0aW9uRW5kXG4gICAgfVxuXG4gICAgc2hvd0xpZ2h0Ym94QW5pbWF0aW9uRW5kKCl7XG4gICAgICAgIHRoaXMuc2V0U2hvd1N0YXRlKCdhbmltYXRpb24tZW5kJyk7XG4gICAgICAgIHRoaXMuY29udGFpbmVyU3R5bGVzID0ge1xuICAgICAgICAgICAgdHJhbnNmb3JtOiAndHJhbnNsYXRlM2QoMCwgMCwgMCknLFxuICAgICAgICAgICAgaGVpZ2h0OiAnMTAwJScsXG4gICAgICAgICAgICB3aWR0aDogJzEwMCUnLFxuICAgICAgICB9XG4gICAgfVxuXG4gICAgY2xvc2VMaWdodGJveCgpe1xuICAgICAgICB0aGlzLnNldENsb3NpbmdTdGF0ZSgnaW5pdGlhbCcpO1xuICAgICAgICB0aGlzLmhvc3RTaG93biA9IGZhbHNlO1xuICAgICAgICB0aGlzLmNsb3NlTGlnaHRib3hJbml0aWFsKCk7XG4gICAgfVxuXG4gICAgY2xvc2VMaWdodGJveEluaXRpYWwoKXtcbiAgICAgICAgdGhpcy5zZXRDbG9zaW5nU3RhdGUoJ2luaXRpYWwtc3R5bGVzJyk7XG5cbiAgICAgICAgLy8gTW9kZTogem9vbSBwcmVsb2FkZXJcbiAgICAgICAgaWYgKHRoaXMuYW5pbWF0aW9uTW9kZSA9PT0gJ3pvb20tcHJlbG9hZGVyJyl7XG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lclN0eWxlcyA9IHtcbiAgICAgICAgICAgICAgICB0cmFuc2Zvcm06IHRoaXMuY29udGFpbmVyRnVsbHNjcmVlblBvc2l0aW9uLFxuICAgICAgICAgICAgICAgIGhlaWdodDogdGhpcy52aXJ0dWFsSW1hZ2VEaW1lbnNpb24uaGVpZ2h0ICsgJ3B4JyxcbiAgICAgICAgICAgICAgICB3aWR0aDogdGhpcy52aXJ0dWFsSW1hZ2VEaW1lbnNpb24ud2lkdGggKyAncHgnLFxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gTW9kZTogZGVmYXVsdFxuICAgICAgICBpZiAodGhpcy5hbmltYXRpb25Nb2RlID09PSAnZGVmYXVsdCcpe1xuICAgICAgICAgICAgdGhpcy5jb250YWluZXJTdHlsZXMub3BhY2l0eSA9ICcxJztcbiAgICAgICAgfVxuXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5jbG9zZUxpZ2h0Ym94QW5pbWF0aW9uKCk7XG4gICAgICAgIH0sIHRoaXMubWluVGltZW91dCk7XG4gICAgfVxuXG4gICAgY2xvc2VMaWdodGJveEFuaW1hdGlvbigpe1xuICAgICAgICB0aGlzLnNldENsb3NpbmdTdGF0ZSgnYW5pbWF0aW9uJyk7XG5cbiAgICAgICAgLy8gTW9kZTogem9vbSBwcmVsb2FkZXJcbiAgICAgICAgaWYgKHRoaXMuYW5pbWF0aW9uTW9kZSA9PT0gJ3pvb20tcHJlbG9hZGVyJyl7XG4gICAgICAgICAgICB0aGlzLmhvc3RBbmltYXRpb24gPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5jb250YWluZXJTdHlsZXMgPSB7XG4gICAgICAgICAgICAgICAgdHJhbnNmb3JtOiB0aGlzLmNvbnRhaW5lckluaXRpYWxQb3NpdGlvbixcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IHRoaXMuZ2V0Q29udGFpbmVySGVpZ2h0KCksXG4gICAgICAgICAgICAgICAgd2lkdGg6IHRoaXMuZ2V0Q29udGFpbmVyV2lkdGgoKSxcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5ob3N0U3R5bGVCYWNrZ3JvdW5kQ29sb3IgPSAnJztcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIE1vZGU6IGRlZmF1bHRcbiAgICAgICAgaWYgKHRoaXMuYW5pbWF0aW9uTW9kZSA9PT0gJ2RlZmF1bHQnKXtcbiAgICAgICAgICAgIHRoaXMuaG9zdEFuaW1hdGlvbiA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lclN0eWxlcy5vcGFjaXR5ID0gJzAnO1xuICAgICAgICAgICAgdGhpcy5ob3N0U3R5bGVCYWNrZ3JvdW5kQ29sb3IgPSAnJztcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uRHVyYXRpb24oKTtcbiAgICAgICAgLy8gbmV4dCBzdGVwOiBoYW5kbGVMaWdodGJveFRyYW5zaXRpb25FbmRcblxuICAgICAgICBpZiAodGhpcy5hbmltYXRpb25EdXJhdGlvbiA9PT0gMCl7IC8vIGluIHRoZSBmdXR1cmUsIGNoYW5nZSB0byBhIHR5cGUgY29udmVyc2lvbiBnZXR0ZXJcbiAgICAgICAgICAgIHRoaXMuY2xvc2VMaWdodGJveEFuaW1hdGlvbkVuZCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgY2xvc2VMaWdodGJveEFuaW1hdGlvbkVuZCgpe1xuICAgICAgICB0aGlzLnNldENsb3NpbmdTdGF0ZSgnYW5pbWF0aW9uLWVuZCcpO1xuICAgICAgICB0aGlzLmV2ZW50cy5lbWl0KHt0eXBlOiAnY2xvc2UnfSk7XG5cbiAgICAgICAgLy8gTW9kZTogem9vbSBwcmVsb2FkZXJcbiAgICAgICAgaWYgKHRoaXMuYW5pbWF0aW9uTW9kZSA9PT0gJ3pvb20tcHJlbG9hZGVyJyl7XG4gICAgICAgICAgICB0aGlzLnNob3dUaHVtYm5haWxJbWFnZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLypcbiAgICAgKiBUcmFuc2l0aW9uIEVuZFxuICAgICAqL1xuXG4gICAgaGFuZGxlTGlnaHRib3hUcmFuc2l0aW9uRW5kKGV2ZW50KXtcbiAgICAgICAgaWYgKHRoaXMuc2hvd1N0YXRlID09PSAnYW5pbWF0aW9uJyl7XG4gICAgICAgICAgICB0aGlzLnNob3dMaWdodGJveEFuaW1hdGlvbkVuZCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gTGFzdCBjbG9zZSBzdGVwXG4gICAgICAgIGlmICh0aGlzLmNsb3NpbmdTdGF0ZSA9PT0gJ2FuaW1hdGlvbicpe1xuICAgICAgICAgICAgdGhpcy5jbG9zZUxpZ2h0Ym94QW5pbWF0aW9uRW5kKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBuZXh0KCl7XG4gICAgICAgIGlmICh0aGlzLmFuaW1hdGlvbk1vZGUgPT09ICd6b29tLXByZWxvYWRlcicpe1xuICAgICAgICAgICAgdGhpcy5zaG93VGh1bWJuYWlsSW1hZ2UoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmlzTGFzdEltYWdlKXtcbiAgICAgICAgICAgIGlmICh0aGlzLnByb3BlcnRpZXMubG9vcCl7XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50SW1hZ2VJbmRleCA9IDA7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudEltYWdlSW5kZXgrKztcbiAgICAgICAgICAgIHRoaXMuY3VyckltYWdlTG9hZGluZ1N0YXRlID0gJ2xvYWRpbmcnO1xuICAgICAgICB9XG5cbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy5jdXJySW1hZ2VMb2FkaW5nU3RhdGUgIT09ICd1cGxvYWRlZCcpe1xuICAgICAgICAgICAgICAgIHRoaXMuY3VyckltYWdlTG9hZGluZ1N0YXRlID0gJ2xvYWRpbmcnO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCB0aGlzLnByZWxvYWRlclRpbWVvdXQpO1xuICAgIH1cblxuICAgIHByZXYoKXtcbiAgICAgICAgaWYgKHRoaXMuYW5pbWF0aW9uTW9kZSA9PT0gJ3pvb20tcHJlbG9hZGVyJyl7XG4gICAgICAgICAgICB0aGlzLnNob3dUaHVtYm5haWxJbWFnZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuaXNGaXJzdEltYWdlKXtcbiAgICAgICAgICAgIGlmICh0aGlzLnByb3BlcnRpZXMubG9vcCl7XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50SW1hZ2VJbmRleCA9IHRoaXMubGF0ZXN0SW1hZ2VJbmRleDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50SW1hZ2VJbmRleC0tO1xuICAgICAgICAgICAgdGhpcy5jdXJySW1hZ2VMb2FkaW5nU3RhdGUgPSAnbG9hZGluZyc7XG4gICAgICAgIH1cblxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLmN1cnJJbWFnZUxvYWRpbmdTdGF0ZSAhPT0gJ3VwbG9hZGVkJyl7XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJySW1hZ2VMb2FkaW5nU3RhdGUgPSAnbG9hZGluZyc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHRoaXMucHJlbG9hZGVyVGltZW91dCk7XG4gICAgfVxuXG4gICAgc2V0TWF4RGltZW5zaW9ucygpe1xuICAgICAgICB0aGlzLmxpZ2h0Ym94SW1hZ2UubmF0aXZlRWxlbWVudC5zdHlsZS5tYXhIZWlnaHQgPSAnY2FsYygnICsgdGhpcy5wcm9wZXJ0aWVzLmltYWdlTWF4SGVpZ2h0ICsgJyknO1xuICAgICAgICB0aGlzLmxpZ2h0Ym94SW1hZ2UubmF0aXZlRWxlbWVudC5zdHlsZS5tYXhXaWR0aCA9IHRoaXMucHJvcGVydGllcy5pbWFnZU1heFdpZHRoO1xuICAgIH1cblxuICAgIGhhbmRsZVBpbmNoWm9vbUV2ZW50cyhldmVudCl7XG4gICAgICAgIGlmIChldmVudC50eXBlID09PSBcInpvb20taW5cIil7XG4gICAgICAgICAgICB0aGlzLmlzWm9vbUluID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChldmVudC50eXBlID09PSBcInpvb20tb3V0XCIpe1xuICAgICAgICAgICAgdGhpcy5pc1pvb21JbiA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0Q29udGFpbmVyV2lkdGgoKTpzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy50aHVtYm5haWxJbWFnZVBvc2l0aW9uLndpZHRoIC8gdGhpcy5jb250YWluZXJTY2FsZSArICdweCc7XG4gICAgfVxufSAiXX0=