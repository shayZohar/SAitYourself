/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, HostBinding, ContentChildren, QueryList } from '@angular/core';
import { EventService } from './event.service';
import { LightboxDirective } from './lightbox.directive';
import { CrystalLightbox } from './lightbox.service';
export class LightboxGroupDirective {
    /**
     * @param {?} eventService
     * @param {?} lightbox
     */
    constructor(eventService, lightbox) {
        this.eventService = eventService;
        this.lightbox = lightbox;
        this.thumbnailImages = [];
        this.images = [];
        this.properties = {};
        this.hostLightboxGroup = true;
        this.globalEventsSubscription = this.eventService.emitter.subscribe((/**
         * @param {?} event
         * @return {?}
         */
        (event) => {
            this.handleGlobalEvents(event);
        }));
    }
    /**
     * @return {?}
     */
    get lightboxDirectiveList() {
        if (this._lightboxDirectiveList) {
            return this._lightboxDirectiveList.toArray();
        }
        else {
            return [];
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    handleGlobalEvents(event) {
        if (event.type === 'thumbnail:click') {
            this.thumbnailImageElement = event.elementRef.nativeElement;
            this.thumbnailImages = this.getThumbnailImages();
            this.thumbnailImageIndex = this.getThumbnailImageIndex(this.thumbnailImageElement);
            if (this.thumbnailImageIndex == undefined) {
                return;
            }
            this.thumbnailLightboxDirective = this.getThumbnailLightboxDirective(this.thumbnailImageIndex);
            this.images = this.getImages();
            this.properties = event.properties;
            this.properties.index = this.thumbnailImageIndex;
            this.lightbox.open({
                images: this.images,
                //index: this.thumbnailImageIndex,
                properties: this.properties
            });
        }
    }
    /**
     * @param {?} element
     * @return {?}
     */
    getThumbnailImageIndex(element) {
        /** @type {?} */
        const images = this.thumbnailImages;
        for (var i = 0; i < images.length; i++) {
            if (element === images[i]) {
                return i;
            }
        }
    }
    /**
     * @param {?} index
     * @return {?}
     */
    getThumbnailLightboxDirective(index) {
        return this.lightboxDirectiveList[index];
    }
    /**
     * @return {?}
     */
    getThumbnailImages() {
        /** @type {?} */
        let thumbnailImages = [];
        this.lightboxDirectiveList.forEach((/**
         * @param {?} el
         * @return {?}
         */
        el => {
            thumbnailImages.push(el['elementRef'].nativeElement);
        }));
        return thumbnailImages;
    }
    /**
     * @return {?}
     */
    getImages() {
        /** @type {?} */
        let images = [];
        this.lightboxDirectiveList.forEach((/**
         * @param {?} el
         * @return {?}
         */
        el => {
            /** @type {?} */
            let image = {};
            /** @type {?} */
            const nativeElement = el['elementRef'].nativeElement;
            if (el.fullImage) {
                image.fullImage = el.fullImage;
            }
            image.thumbnailImage = {
                path: nativeElement.src,
                height: nativeElement.naturalHeight,
                width: nativeElement.naturalWidth
            };
            image.nativeElement = nativeElement;
            images.push(image);
        }));
        return images;
    }
}
LightboxGroupDirective.decorators = [
    { type: Directive, args: [{
                selector: '[lightbox-group]'
            },] }
];
/** @nocollapse */
LightboxGroupDirective.ctorParameters = () => [
    { type: EventService },
    { type: CrystalLightbox }
];
LightboxGroupDirective.propDecorators = {
    hostLightboxGroup: [{ type: HostBinding, args: ['class.lightbox-group',] }],
    _lightboxDirectiveList: [{ type: ContentChildren, args: [LightboxDirective, { descendants: true },] }]
};
if (false) {
    /** @type {?} */
    LightboxGroupDirective.prototype.thumbnailImageElement;
    /** @type {?} */
    LightboxGroupDirective.prototype.thumbnailLightboxDirective;
    /** @type {?} */
    LightboxGroupDirective.prototype.thumbnailImageIndex;
    /** @type {?} */
    LightboxGroupDirective.prototype.thumbnailImages;
    /** @type {?} */
    LightboxGroupDirective.prototype.images;
    /** @type {?} */
    LightboxGroupDirective.prototype.properties;
    /** @type {?} */
    LightboxGroupDirective.prototype.globalEventsSubscription;
    /** @type {?} */
    LightboxGroupDirective.prototype.hostLightboxGroup;
    /** @type {?} */
    LightboxGroupDirective.prototype._lightboxDirectiveList;
    /**
     * @type {?}
     * @private
     */
    LightboxGroupDirective.prototype.eventService;
    /**
     * @type {?}
     * @private
     */
    LightboxGroupDirective.prototype.lightbox;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlnaHRib3gtZ3JvdXAuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGNyeXN0YWx1aS9hbmd1bGFyLWxpZ2h0Ym94LyIsInNvdXJjZXMiOlsibGliL2xpZ2h0Ym94LWdyb3VwLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUUsZUFBZSxFQUFFLFNBQVMsRUFBYyxNQUFNLGVBQWUsQ0FBQztBQUMvRixPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDL0MsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQUssc0JBQXNCLENBQUE7QUFDdkQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFLLG9CQUFvQixDQUFDO0FBT3BELE1BQU0sT0FBTyxzQkFBc0I7Ozs7O0lBbUIvQixZQUNZLFlBQTBCLEVBQzFCLFFBQXlCO1FBRHpCLGlCQUFZLEdBQVosWUFBWSxDQUFjO1FBQzFCLGFBQVEsR0FBUixRQUFRLENBQWlCO1FBakJyQyxvQkFBZSxHQUFHLEVBQUUsQ0FBQztRQUNyQixXQUFNLEdBQUcsRUFBRSxDQUFDO1FBQ1osZUFBVSxHQUFlLEVBQUUsQ0FBQztRQVdTLHNCQUFpQixHQUFZLElBQUksQ0FBQztRQU1uRSxJQUFJLENBQUMsd0JBQXdCLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsU0FBUzs7OztRQUMvRCxDQUFDLEtBQUssRUFBRSxFQUFFO1lBQ04sSUFBSSxDQUFDLGtCQUFrQixDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ25DLENBQUMsRUFDSixDQUFDO0lBQ04sQ0FBQzs7OztJQW5CRCxJQUFJLHFCQUFxQjtRQUNyQixJQUFJLElBQUksQ0FBQyxzQkFBc0IsRUFBQztZQUM1QixPQUFPLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxPQUFPLEVBQUUsQ0FBQztTQUNoRDthQUFNO1lBQ0gsT0FBTyxFQUFFLENBQUM7U0FDYjtJQUNMLENB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QUFzQjtxQ0FDbEMsZUFBZSxTQUFDLGlCQUFpQixFQUFFLEVBQUMsV0FBVyxFQUFFLElBQUksRUFBQzs7OztJQWpCdkQsdURBQXNCOztJQUN0Qiw0REFBOEM7O0lBQzlDLHFEQUE0Qjs7SUFDNUIsaURBQXFCOztJQUNyQix3Q0FBWTs7SUFDWiw0Q0FBNEI7O0lBQzVCLDBEQUF5Qjs7SUFVekIsbURBQXVFOztJQUN2RSx3REFBOEc7Ozs7O0lBRTFHLDhDQUFrQzs7Ozs7SUFDbEMsMENBQWlDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGlyZWN0aXZlLCBIb3N0QmluZGluZywgQ29udGVudENoaWxkcmVuLCBRdWVyeUxpc3QsIEVsZW1lbnRSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEV2ZW50U2VydmljZSB9IGZyb20gJy4vZXZlbnQuc2VydmljZSc7XG5pbXBvcnQgeyBMaWdodGJveERpcmVjdGl2ZSB9IGZyb20nLi9saWdodGJveC5kaXJlY3RpdmUnIFxuaW1wb3J0IHsgQ3J5c3RhbExpZ2h0Ym94IH0gZnJvbScuL2xpZ2h0Ym94LnNlcnZpY2UnO1xuaW1wb3J0IHsgUHJvcGVydGllcywgSW1hZ2VFeHRlbmRlZCB9IGZyb20gJy4vaW50ZXJmYWNlcyc7XG5cbkBEaXJlY3RpdmUoe1xuICAgIHNlbGVjdG9yOiAnW2xpZ2h0Ym94LWdyb3VwXSdcbn0pXG5cbmV4cG9ydCBjbGFzcyBMaWdodGJveEdyb3VwRGlyZWN0aXZlIHtcbiAgICB0aHVtYm5haWxJbWFnZUVsZW1lbnQ7XG4gICAgdGh1bWJuYWlsTGlnaHRib3hEaXJlY3RpdmU6IExpZ2h0Ym94RGlyZWN0aXZlO1xuICAgIHRodW1ibmFpbEltYWdlSW5kZXg6IG51bWJlcjtcbiAgICB0aHVtYm5haWxJbWFnZXMgPSBbXTtcbiAgICBpbWFnZXMgPSBbXTtcbiAgICBwcm9wZXJ0aWVzOiBQcm9wZXJ0aWVzID0ge307IFxuICAgIGdsb2JhbEV2ZW50c1N1YnNjcmlwdGlvbjtcblxuICAgIGdldCBsaWdodGJveERpcmVjdGl2ZUxpc3QoKXtcbiAgICAgICAgaWYgKHRoaXMuX2xpZ2h0Ym94RGlyZWN0aXZlTGlzdCl7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fbGlnaHRib3hEaXJlY3RpdmVMaXN0LnRvQXJyYXkoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIEBIb3N0QmluZGluZygnY2xhc3MubGlnaHRib3gtZ3JvdXAnKSBob3N0TGlnaHRib3hHcm91cDogYm9vbGVhbiA9IHRydWU7XG4gICAgQENvbnRlbnRDaGlsZHJlbihMaWdodGJveERpcmVjdGl2ZSwge2Rlc2NlbmRhbnRzOiB0cnVlfSkgX2xpZ2h0Ym94RGlyZWN0aXZlTGlzdDogUXVlcnlMaXN0PExpZ2h0Ym94RGlyZWN0aXZlPjsgXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByaXZhdGUgZXZlbnRTZXJ2aWNlOiBFdmVudFNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgbGlnaHRib3g6IENyeXN0YWxMaWdodGJveCkge1xuXG4gICAgICAgIHRoaXMuZ2xvYmFsRXZlbnRzU3Vic2NyaXB0aW9uID0gdGhpcy5ldmVudFNlcnZpY2UuZW1pdHRlci5zdWJzY3JpYmUoXG4gICAgICAgICAgICAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUdsb2JhbEV2ZW50cyhldmVudCk7IFxuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxuICAgIGhhbmRsZUdsb2JhbEV2ZW50cyhldmVudCl7XG4gICAgICAgIGlmIChldmVudC50eXBlID09PSAndGh1bWJuYWlsOmNsaWNrJyl7XG4gICAgICAgICAgICB0aGlzLnRodW1ibmFpbEltYWdlRWxlbWVudCA9IGV2ZW50LmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudDtcbiAgICAgICAgICAgIHRoaXMudGh1bWJuYWlsSW1hZ2VzID0gdGhpcy5nZXRUaHVtYm5haWxJbWFnZXMoKTtcbiAgICAgICAgICAgIHRoaXMudGh1bWJuYWlsSW1hZ2VJbmRleCA9IHRoaXMuZ2V0VGh1bWJuYWlsSW1hZ2VJbmRleCh0aGlzLnRodW1ibmFpbEltYWdlRWxlbWVudCk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnRodW1ibmFpbEltYWdlSW5kZXggPT0gdW5kZWZpbmVkKXtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMudGh1bWJuYWlsTGlnaHRib3hEaXJlY3RpdmUgPSB0aGlzLmdldFRodW1ibmFpbExpZ2h0Ym94RGlyZWN0aXZlKHRoaXMudGh1bWJuYWlsSW1hZ2VJbmRleCk7XG4gICAgICAgICAgICB0aGlzLmltYWdlcyA9IHRoaXMuZ2V0SW1hZ2VzKCk7XG4gICAgICAgICAgICB0aGlzLnByb3BlcnRpZXMgPSBldmVudC5wcm9wZXJ0aWVzO1xuICAgICAgICAgICAgdGhpcy5wcm9wZXJ0aWVzLmluZGV4ID0gdGhpcy50aHVtYm5haWxJbWFnZUluZGV4O1xuXG4gICAgICAgICAgICB0aGlzLmxpZ2h0Ym94Lm9wZW4oe1xuICAgICAgICAgICAgICAgIGltYWdlczogdGhpcy5pbWFnZXMsXG4gICAgICAgICAgICAgICAgLy9pbmRleDogdGhpcy50aHVtYm5haWxJbWFnZUluZGV4LFxuICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHRoaXMucHJvcGVydGllc1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXRUaHVtYm5haWxJbWFnZUluZGV4KGVsZW1lbnQpe1xuICAgICAgICBjb25zdCBpbWFnZXMgPSB0aGlzLnRodW1ibmFpbEltYWdlcztcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbWFnZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChlbGVtZW50ID09PSBpbWFnZXNbaV0pe1xuICAgICAgICAgICAgICAgIHJldHVybiBpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0VGh1bWJuYWlsTGlnaHRib3hEaXJlY3RpdmUoaW5kZXgpe1xuICAgICAgICByZXR1cm4gdGhpcy5saWdodGJveERpcmVjdGl2ZUxpc3RbaW5kZXhdO1xuICAgIH1cblxuICAgIGdldFRodW1ibmFpbEltYWdlcygpe1xuICAgICAgICBsZXQgdGh1bWJuYWlsSW1hZ2VzID0gW107XG4gICAgICAgIHRoaXMubGlnaHRib3hEaXJlY3RpdmVMaXN0LmZvckVhY2goZWwgPT4ge1xuICAgICAgICAgICAgdGh1bWJuYWlsSW1hZ2VzLnB1c2goZWxbJ2VsZW1lbnRSZWYnXS5uYXRpdmVFbGVtZW50KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB0aHVtYm5haWxJbWFnZXM7XG4gICAgfVxuXG4gICAgZ2V0SW1hZ2VzKCl7XG4gICAgICAgIGxldCBpbWFnZXMgPSBbXTtcbiAgICAgICAgdGhpcy5saWdodGJveERpcmVjdGl2ZUxpc3QuZm9yRWFjaChlbCA9PiB7XG4gICAgICAgICAgICBsZXQgaW1hZ2U6IEltYWdlRXh0ZW5kZWQgPSB7fTtcbiAgICAgICAgICAgIGNvbnN0IG5hdGl2ZUVsZW1lbnQgPSBlbFsnZWxlbWVudFJlZiddLm5hdGl2ZUVsZW1lbnQ7XG5cbiAgICAgICAgICAgIGlmIChlbC5mdWxsSW1hZ2Upe1xuICAgICAgICAgICAgICAgIGltYWdlLmZ1bGxJbWFnZSA9IGVsLmZ1bGxJbWFnZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaW1hZ2UudGh1bWJuYWlsSW1hZ2UgPSB7XG4gICAgICAgICAgICAgICAgcGF0aDogbmF0aXZlRWxlbWVudC5zcmMsXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiBuYXRpdmVFbGVtZW50Lm5hdHVyYWxIZWlnaHQsXG4gICAgICAgICAgICAgICAgd2lkdGg6IG5hdGl2ZUVsZW1lbnQubmF0dXJhbFdpZHRoXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGltYWdlLm5hdGl2ZUVsZW1lbnQgPSBuYXRpdmVFbGVtZW50O1xuICAgICAgICAgICAgaW1hZ2VzLnB1c2goaW1hZ2UpO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gaW1hZ2VzO1xuICAgIH1cbn1cbiJdfQ==