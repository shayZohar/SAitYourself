/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, HostBinding, ViewChild, ElementRef } from '@angular/core';
import { EventService } from './event.service';
import { Utils } from './utils';
export class LightboxCommonComponent {
    /**
     * @param {?} eventService
     */
    constructor(eventService) {
        this.eventService = eventService;
        this.currentImageIndex = 0;
        this.indexCurrentSlide = 1;
        this.containerStyles = {
            transition: '',
            transform: '',
            width: '',
            height: '',
            opacity: ''
        };
        this.currImageLoadingState = 'not-loaded';
        this.isMobile = Utils.mobileCheck();
    }
    /**
     * @return {?}
     */
    get lightboxImage() {
        return this._lightboxImage;
    }
    /**
     * @return {?}
     */
    get lightboxImageElement() {
        if (this.lightboxImage) {
            return this.lightboxImage.nativeElement;
        }
    }
    /**
     * @return {?}
     */
    get lightboxImageNaturalHeight() {
        if (this.lightboxImageElement) {
            return this.lightboxImageElement.naturalHeight;
        }
    }
    /**
     * @return {?}
     */
    get lightboxImageNaturalWidth() {
        if (this.lightboxImageElement) {
            return this.lightboxImageElement.naturalWidth;
        }
    }
    /**
     * @return {?}
     */
    get index() {
        return this.currentImageIndex;
    }
    /**
     * @return {?}
     */
    get properties() {
        return this.lightboxData.properties;
    }
    /**
     * @return {?}
     */
    get images() {
        return this.lightboxData.images || [this.lightboxData.image];
    }
    /**
     * @return {?}
     */
    get thumbnailImage() {
        return this.images[this.currentImageIndex].nativeElement;
    }
    /**
     * @return {?}
     */
    get thumbnailImagePosition() {
        return this.thumbnailImage.getBoundingClientRect();
    }
    // Image size if it is larger than the window size
    /**
     * @return {?}
     */
    get virtualImageDimension() {
        /** @type {?} */
        let height = this.lightboxImageNaturalHeight;
        /** @type {?} */
        let width = height * this.imageAspectRatio;
        /** @type {?} */
        const windowWidth = document.body.clientWidth;
        /** @type {?} */
        const windowHeight = window.innerHeight;
        if (this.isImageLargerWindow) {
            if (height > windowHeight) {
                height = windowHeight;
                width = height * this.imageAspectRatio;
            }
            if (width > windowWidth) {
                width = windowWidth;
                height = width / this.imageAspectRatio;
            }
        }
        else {
            width = this.lightboxImageNaturalWidth;
            height = this.lightboxImageNaturalHeight;
        }
        if (width === 0 || Number.parseInt(height) === 0) {
            return { width: 200, height: 200 };
        }
        return { width, height };
    }
    /**
     * @return {?}
     */
    get containerInitialPosition() {
        /** @type {?} */
        const scale = (this.showState === 'initial-thumbnail-image') ? 1 : this.containerScale;
        /** @type {?} */
        const top = this.thumbnailImagePosition.top;
        /** @type {?} */
        const left = this.thumbnailImagePosition.left;
        return 'matrix(' + scale + ', 0, 0, ' + scale + ',' + left + ',' + top + ')';
    }
    /**
     * @return {?}
     */
    get containerFullscreenPosition() {
        /** @type {?} */
        const left = (document.body.clientWidth - this.virtualImageDimension.width) / 2;
        /** @type {?} */
        const top = (window.innerHeight - this.virtualImageDimension.height) / 2;
        return 'translate3d(' + left + 'px, ' + top + 'px, 0)';
    }
    /**
     * @return {?}
     */
    get containerScale() {
        return this.thumbnailImagePosition.width / this.virtualImageDimension.width;
    }
    /**
     * @return {?}
     */
    get imageAspectRatio() {
        return this.thumbnailImage.naturalWidth / this.thumbnailImage.naturalHeight;
    }
    /**
     * @return {?}
     */
    get isImageLargerWindow() {
        /** @type {?} */
        const imageNaturalWidth = this.lightboxImageNaturalWidth;
        /** @type {?} */
        const imageNaturalHeight = this.lightboxImageNaturalHeight;
        /** @type {?} */
        const windowWidth = document.body.clientWidth;
        /** @type {?} */
        const windowHeight = window.innerHeight;
        return imageNaturalWidth > windowWidth || imageNaturalHeight > windowHeight;
    }
    /**
     * @return {?}
     */
    get isFirstImage() {
        if (this.properties.loop) {
            return false;
        }
        else {
            return this.index === 0;
        }
    }
    /**
     * @return {?}
     */
    get isLastImage() {
        if (this.properties.loop) {
            return false;
        }
        else {
            return this.index === this.latestImageIndex;
        }
    }
    /**
     * @return {?}
     */
    get latestImageIndex() {
        return this.images.length - 1;
    }
    /**
     * @return {?}
     */
    get backgroundColor() {
        /** @type {?} */
        const opacity = this.properties.backgroundOpacity;
        /** @type {?} */
        const color = this.properties.backgroundColor;
        if (color === 'black') {
            return 'rgba(0, 0, 0, ' + opacity + ')';
        }
        else {
            return 'rgba(255, 255, 255, ' + opacity + ')';
        }
    }
    /**
     * @return {?}
     */
    get animationDuration() {
        /** @type {?} */
        const animationDuration = this.properties.animationDuration;
        if (typeof animationDuration === "string") {
            return Number.parseInt(animationDuration);
        }
        else {
            return animationDuration;
        }
    }
    /**
     * @return {?}
     */
    get animationMode() {
        if (this.currImageLoadingState === 'error') {
            return 'default';
        }
        return this.properties.animationMode;
    }
    /**
     * @return {?}
     */
    get animationTimingFunction() {
        return this.properties.animationTimingFunction;
    }
    /**
     * @return {?}
     */
    get closeButtonText() {
        return this.properties.closeButtonText;
    }
    /**
     * @return {?}
     */
    get counterSeparator() {
        return this.properties.counterSeparator;
    }
    /**
     * @return {?}
     */
    get counter() {
        return this.currentImageIndex + 1 + this.counterSeparator + this.images.length;
    }
    /**
     * @param {?} type
     * @param {?} state
     * @return {?}
     */
    emitState(type, state) {
        if (state === 'initial-virtual-image' ||
            state === 'initial-styles') {
            return;
        }
        if (state === 'initial-default' ||
            state === 'initial-thumbnail-image') {
            state = 'initial';
        }
        this.eventService.emitChangeEvent({
            type: type + ':' + state
        });
    }
    /**
     * @param {?} state
     * @return {?}
     */
    setShowState(state) {
        this.showState = state;
        this.emitState('show-state', state);
    }
    /**
     * @param {?} state
     * @return {?}
     */
    setClosingState(state) {
        this.closingState = state;
        this.emitState('closing-state', state);
    }
    /**
     * @return {?}
     */
    setAnimationDuration() {
        this.hostStyleTransition = 'background-color ' + this.animationDuration + 'ms';
        this.containerStyles.transition = 'all ' + this.animationDuration + 'ms ' + this.animationTimingFunction;
    }
    /**
     * @return {?}
     */
    setBackgroundColor() {
        this.hostStyleBackgroundColor = this.backgroundColor;
    }
    /**
     * @return {?}
     */
    getContainerHeight() {
        return this.thumbnailImagePosition.height / this.containerScale + 'px';
    }
    /**
     * @return {?}
     */
    showThumbnailImage() {
        this.thumbnailImage.style.opacity = '';
    }
    /**
     * @return {?}
     */
    hideThumbnailImage() {
        this.thumbnailImage.style.opacity = 0;
    }
    /**
     * @return {?}
     */
    updateThumbnailPosition() {
        this.containerStyles.transform = this.containerInitialPosition;
    }
}
LightboxCommonComponent.decorators = [
    { type: Component, args: [{
                selector: 'lightbox-common',
                template: ''
            }] }
];
/** @nocollapse */
LightboxCommonComponent.ctorParameters = () => [
    { type: EventService }
];
LightboxCommonComponent.propDecorators = {
    lightboxData: [{ type: Input }],
    hostStyleBackgroundColor: [{ type: HostBinding, args: ['style.backgroundColor',] }],
    hostStyleTransition: [{ type: HostBinding, args: ['style.transition',] }],
    _imageFirst: [{ type: ViewChild, args: ['imageFirst',] }],
    _imageSecond: [{ type: ViewChild, args: ['imageSecond',] }],
    _imageLast: [{ type: ViewChild, args: ['imageLast',] }],
    _lightboxImage: [{ type: ViewChild, args: ['lightboxImage',] }]
};
if (false) {
    /** @type {?} */
    LightboxCommonComponent.prototype.currentImageIndex;
    /** @type {?} */
    LightboxCommonComponent.prototype.indexCurrentSlide;
    /** @type {?} */
    LightboxCommonComponent.prototype.showState;
    /** @type {?} */
    LightboxCommonComponent.prototype.closingState;
    /** @type {?} */
    LightboxCommonComponent.prototype.containerStyles;
    /** @type {?} */
    LightboxCommonComponent.prototype.currImageLoadingState;
    /** @type {?} */
    LightboxCommonComponent.prototype.isMobile;
    /** @type {?} */
    LightboxCommonComponent.prototype.lightboxData;
    /** @type {?} */
    LightboxCommonComponent.prototype.hostStyleBackgroundColor;
    /** @type {?} */
    LightboxCommonComponent.prototype.hostStyleTransition;
    /** @type {?} */
    LightboxCommonComponent.prototype._imageFirst;
    /** @type {?} */
    LightboxCommonComponent.prototype._imageSecond;
    /** @type {?} */
    LightboxCommonComponent.prototype._imageLast;
    /** @type {?} */
    LightboxCommonComponent.prototype._lightboxImage;
    /** @type {?} */
    LightboxCommonComponent.prototype.eventService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlnaHRib3gtY29tbW9uLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BjcnlzdGFsdWkvYW5ndWxhci1saWdodGJveC8iLCJzb3VyY2VzIjpbImxpYi9saWdodGJveC1jb21tb24uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxXQUFXLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUdyRixPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDL0MsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLFNBQVMsQ0FBQztBQU9oQyxNQUFNLE9BQU8sdUJBQXVCOzs7O0lBOExoQyxZQUFtQixZQUEwQjtRQUExQixpQkFBWSxHQUFaLFlBQVksQ0FBYztRQTVMN0Msc0JBQWlCLEdBQVcsQ0FBQyxDQUFDO1FBQzlCLHNCQUFpQixHQUFHLENBQUMsQ0FBQztRQUd0QixvQkFBZSxHQUFRO1lBQ25CLFVBQVUsRUFBRSxFQUFFO1lBQ2QsU0FBUyxFQUFFLEVBQUU7WUFDYixLQUFLLEVBQUUsRUFBRTtZQUNULE1BQU0sRUFBRSxFQUFFO1lBQ1YsT0FBTyxFQUFFLEVBQUU7U0FDZCxDQUFDO1FBQ0YsMEJBQXFCLEdBQW9ELFlBQVksQ0FBQztRQWtMbEYsSUFBSSxDQUFDLFFBQVEsR0FBRyxLQUFLLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDeEMsQ0FBQzs7OztJQXRLRCxJQUFJLGFBQWE7UUFDYixPQUFPLElBQUksQ0FBQyxjQUFjLENBQUM7SUFDL0IsQ0FBQzs7OztJQUVELElBQUksb0JBQW9CO1FBQ3BCLElBQUksSUFBSSxDQUFDLGFBQWEsRUFBQztZQUNuQixPQUFPLElBQUksQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDO1NBQzNDO0lBQ0wsQ0FBQzs7OztJQUVELElBQUksMEJBQTBCO1FBQzFCLElBQUksSUFBSSxDQUFDLG9CQUFv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QixDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQztJQUMzRSxDQUFDOzs7O0lBRUQsa0JBQWtCO1FBQ2QsSUFBSSxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsT0FBTyxHQUFHLEVBQUUsQ0FBQztJQUMzQyxDQUFDOzs7O0lBRUQsa0JBQWtCO1FBQ2QsSUFBSSxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsT0FBTyxHQUFHLENBQUMsQ0FBQztJQUMxQyxDQUFDOzs7O0lBRUQsdUJBQXVCO1FBQ25CLElBQUksQ0FBQyxlQUFlLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyx3QkFBd0IsQ0FBQztJQUNuRSxDQUFDOzs7WUF4UEosU0FBUyxTQUFDO2dCQUNQLFFBQVEsRUFBRSxpQkFBaUI7Z0JBQzNCLFFBQVEsRUFBRSxFQUFFO2FBQ2Y7Ozs7WUFOUSxZQUFZOzs7MkJBd0JoQixLQUFLO3VDQUVMLFdBQVcsU0FBQyx1QkFBdUI7a0NBQ25DLFdBQVcsU0FBQyxrQkFBa0I7MEJBRTlCLFNBQVMsU0FBQyxZQUFZOzJCQUN0QixTQUFTLFNBQUMsYUFBYTt5QkFDdkIsU0FBUyxTQUFDLFdBQVc7NkJBQ3JCLFNBQVMsU0FBQyxlQUFlOzs7O0lBdEIxQixvREFBOEI7O0lBQzlCLG9EQUFzQjs7SUFDdEIsNENBQXFCOztJQUNyQiwrQ0FBMkI7O0lBQzNCLGtEQU1FOztJQUNGLHdEQUFzRjs7SUFDdEYsMkNBQWtCOztJQUVsQiwrQ0FBb0M7O0lBRXBDLDJEQUF1RTs7SUFDdkUsc0RBQTZEOztJQUU3RCw4Q0FBaUQ7O0lBQ2pELCtDQUFtRDs7SUFDbkQsNkNBQStDOztJQUMvQyxpREFBdUQ7O0lBc0szQywrQ0FBaUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBIb3N0QmluZGluZywgVmlld0NoaWxkLCBFbGVtZW50UmVmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IExpZ2h0Ym94RGF0YSwgUHJvcGVydGllcyB9IGZyb20gJy4vaW50ZXJmYWNlcyc7XHJcbmltcG9ydCB7IFNob3dTdGF0ZSwgQ2xvc2luZ1N0YXRlIH0gZnJvbSAnLi90eXBlcyc7XHJcbmltcG9ydCB7IEV2ZW50U2VydmljZSB9IGZyb20gJy4vZXZlbnQuc2VydmljZSc7XHJcbmltcG9ydCB7IFV0aWxzIH0gZnJvbSAnLi91dGlscyc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnbGlnaHRib3gtY29tbW9uJyxcclxuICAgIHRlbXBsYXRlOiAnJ1xyXG59KVxyXG5cclxuZXhwb3J0IGNsYXNzIExpZ2h0Ym94Q29tbW9uQ29tcG9uZW50IHtcclxuXHJcbiAgICBjdXJyZW50SW1hZ2VJbmRleDogbnVtYmVyID0gMDtcclxuICAgIGluZGV4Q3VycmVudFNsaWRlID0gMTtcclxuICAgIHNob3dTdGF0ZTogU2hvd1N0YXRlO1xyXG4gICAgY2xvc2luZ1N0YXRlOiBDbG9zaW5nU3RhdGU7XHJcbiAgICBjb250YWluZXJTdHlsZXM6IGFueSA9IHtcclxuICAgICAgICB0cmFuc2l0aW9uOiAnJyxcclxuICAgICAgICB0cmFuc2Zvcm06ICcnLFxyXG4gICAgICAgIHdpZHRoOiAnJyxcclxuICAgICAgICBoZWlnaHQ6ICcnLFxyXG4gICAgICAgIG9wYWNpdHk6ICcnXHJcbiAgICB9O1xyXG4gICAgY3VyckltYWdlTG9hZGluZ1N0YXRlOiAnbm90LWxvYWRlZCcgfCAnbG9hZGluZycgfCAndXBsb2FkZWQnIHwgJ2Vycm9yJyA9ICdub3QtbG9hZGVkJztcclxuICAgIGlzTW9iaWxlOiBib29sZWFuO1xyXG5cclxuICAgIEBJbnB1dCgpIGxpZ2h0Ym94RGF0YTogTGlnaHRib3hEYXRhO1xyXG5cclxuICAgIEBIb3N0QmluZGluZygnc3R5bGUuYmFja2dyb3VuZENvbG9yJykgaG9zdFN0eWxlQmFja2dyb3VuZENvbG9yOiBzdHJpbmc7XHJcbiAgICBASG9zdEJpbmRpbmcoJ3N0eWxlLnRyYW5zaXRpb24nKSBob3N0U3R5bGVUcmFuc2l0aW9uOiBzdHJpbmc7XHJcblxyXG4gICAgQFZpZXdDaGlsZCgnaW1hZ2VGaXJzdCcpIF9pbWFnZUZpcnN0OiBFbGVtZW50UmVmO1xyXG4gICAgQFZpZXdDaGlsZCgnaW1hZ2VTZWNvbmQnKSBfaW1hZ2VTZWNvbmQ6IEVsZW1lbnRSZWY7XHJcbiAgICBAVmlld0NoaWxkKCdpbWFnZUxhc3QnKSBfaW1hZ2VMYXN0OiBFbGVtZW50UmVmO1xyXG4gICAgQFZpZXdDaGlsZCgnbGlnaHRib3hJbWFnZScpIF9saWdodGJveEltYWdlOiBFbGVtZW50UmVmO1xyXG5cclxuICAgIGdldCBsaWdodGJveEltYWdlKCl7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2xpZ2h0Ym94SW1hZ2U7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGxpZ2h0Ym94SW1hZ2VFbGVtZW50KCl7XHJcbiAgICAgICAgaWYgKHRoaXMubGlnaHRib3hJbWFnZSl7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmxpZ2h0Ym94SW1hZ2UubmF0aXZlRWxlbWVudDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGxpZ2h0Ym94SW1hZ2VOYXR1cmFsSGVpZ2h0KCl7XHJcbiAgICAgICAgaWYgKHRoaXMubGlnaHRib3hJbWFnZUVsZW1lbnQpe1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5saWdodGJveEltYWdlRWxlbWVudC5uYXR1cmFsSGVpZ2h0O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXQgbGlnaHRib3hJbWFnZU5hdHVyYWxXaWR0aCgpe1xyXG4gICAgICAgIGlmICh0aGlzLmxpZ2h0Ym94SW1hZ2VFbGVtZW50KXtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMubGlnaHRib3hJbWFnZUVsZW1lbnQubmF0dXJhbFdpZHRoO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXQgaW5kZXgoKXtcclxuICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50SW1hZ2VJbmRleDtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgcHJvcGVydGllcygpe1xyXG4gICAgICAgIHJldHVybiB0aGlzLmxpZ2h0Ym94RGF0YS5wcm9wZXJ0aWVzO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBpbWFnZXMoKXtcclxuICAgICAgICByZXR1cm4gdGhpcy5saWdodGJveERhdGEuaW1hZ2VzIHx8IFt0aGlzLmxpZ2h0Ym94RGF0YS5pbWFnZV07XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHRodW1ibmFpbEltYWdlKCl7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaW1hZ2VzW3RoaXMuY3VycmVudEltYWdlSW5kZXhdLm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHRodW1ibmFpbEltYWdlUG9zaXRpb24oKXtcclxuICAgICAgICByZXR1cm4gdGhpcy50aHVtYm5haWxJbWFnZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBJbWFnZSBzaXplIGlmIGl0IGlzIGxhcmdlciB0aGFuIHRoZSB3aW5kb3cgc2l6ZVxyXG4gICAgZ2V0IHZpcnR1YWxJbWFnZURpbWVuc2lvbigpe1xyXG4gICAgICAgIGxldCBoZWlnaHQgPSB0aGlzLmxpZ2h0Ym94SW1hZ2VOYXR1cmFsSGVpZ2h0O1xyXG4gICAgICAgIGxldCB3aWR0aCA9IGhlaWdodCAqIHRoaXMuaW1hZ2VBc3BlY3RSYXRpbztcclxuICAgICAgICBjb25zdCB3aW5kb3dXaWR0aCA9IGRvY3VtZW50LmJvZHkuY2xpZW50V2lkdGg7XHJcbiAgICAgICAgY29uc3Qgd2luZG93SGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xyXG5cclxuICAgICAgICBpZiAodGhpcy5pc0ltYWdlTGFyZ2VyV2luZG93KXtcclxuICAgICAgICAgICAgaWYgKGhlaWdodCA+IHdpbmRvd0hlaWdodCl7XHJcbiAgICAgICAgICAgICAgICBoZWlnaHQgPSB3aW5kb3dIZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICB3aWR0aCA9IGhlaWdodCAqIHRoaXMuaW1hZ2VBc3BlY3RSYXRpbztcclxuICAgICAgICAgICAgfSBcclxuXHJcbiAgICAgICAgICAgIGlmICh3aWR0aCA+IHdpbmRvd1dpZHRoKXtcclxuICAgICAgICAgICAgICAgIHdpZHRoID0gd2luZG93V2lkdGg7XHJcbiAgICAgICAgICAgICAgICBoZWlnaHQgPSB3aWR0aCAvIHRoaXMuaW1hZ2VBc3BlY3RSYXRpbztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHdpZHRoID0gdGhpcy5saWdodGJveEltYWdlTmF0dXJhbFdpZHRoO1xyXG4gICAgICAgICAgICBoZWlnaHQgPSB0aGlzLmxpZ2h0Ym94SW1hZ2VOYXR1cmFsSGVpZ2h0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHdpZHRoID09PSAwIHx8IE51bWJlci5wYXJzZUludChoZWlnaHQpID09PSAwKXtcclxuICAgICAgICAgICAgcmV0dXJuIHt3aWR0aDogMjAwLCBoZWlnaHQ6IDIwMH07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4ge3dpZHRoLCBoZWlnaHR9O1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBjb250YWluZXJJbml0aWFsUG9zaXRpb24oKXtcclxuICAgICAgICBjb25zdCBzY2FsZSA9ICAodGhpcy5zaG93U3RhdGUgPT09ICdpbml0aWFsLXRodW1ibmFpbC1pbWFnZScpID8gMSA6IHRoaXMuY29udGFpbmVyU2NhbGU7IFxyXG4gICAgICAgIGNvbnN0IHRvcCA9IHRoaXMudGh1bWJuYWlsSW1hZ2VQb3NpdGlvbi50b3A7XHJcbiAgICAgICAgY29uc3QgbGVmdCA9IHRoaXMudGh1bWJuYWlsSW1hZ2VQb3NpdGlvbi5sZWZ0O1xyXG4gICAgICAgIHJldHVybiAnbWF0cml4KCcrIHNjYWxlICsnLCAwLCAwLCAnKyBzY2FsZSArJywnKyBsZWZ0ICsnLCcrIHRvcCArJyknO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBjb250YWluZXJGdWxsc2NyZWVuUG9zaXRpb24oKXtcclxuICAgICAgICBjb25zdCBsZWZ0ID0gKGRvY3VtZW50LmJvZHkuY2xpZW50V2lkdGggLSB0aGlzLnZpcnR1YWxJbWFnZURpbWVuc2lvbi53aWR0aCkgLyAyO1xyXG4gICAgICAgIGNvbnN0IHRvcCA9ICh3aW5kb3cuaW5uZXJIZWlnaHQgLSB0aGlzLnZpcnR1YWxJbWFnZURpbWVuc2lvbi5oZWlnaHQpIC8gMjtcclxuXHJcbiAgICAgICAgcmV0dXJuICd0cmFuc2xhdGUzZCgnKyBsZWZ0ICsncHgsICcrIHRvcCArJ3B4LCAwKSc7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGNvbnRhaW5lclNjYWxlKCl7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudGh1bWJuYWlsSW1hZ2VQb3NpdGlvbi53aWR0aCAvIHRoaXMudmlydHVhbEltYWdlRGltZW5zaW9uLndpZHRoO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBpbWFnZUFzcGVjdFJhdGlvKCl7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudGh1bWJuYWlsSW1hZ2UubmF0dXJhbFdpZHRoIC8gdGhpcy50aHVtYm5haWxJbWFnZS5uYXR1cmFsSGVpZ2h0O1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBpc0ltYWdlTGFyZ2VyV2luZG93KCk6Ym9vbGVhbiB7XHJcbiAgICAgICAgY29uc3QgaW1hZ2VOYXR1cmFsV2lkdGggPSB0aGlzLmxpZ2h0Ym94SW1hZ2VOYXR1cmFsV2lkdGg7XHJcbiAgICAgICAgY29uc3QgaW1hZ2VOYXR1cmFsSGVpZ2h0ID0gdGhpcy5saWdodGJveEltYWdlTmF0dXJhbEhlaWdodDtcclxuICAgICAgICBjb25zdCB3aW5kb3dXaWR0aCA9IGRvY3VtZW50LmJvZHkuY2xpZW50V2lkdGg7XHJcbiAgICAgICAgY29uc3Qgd2luZG93SGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xyXG4gICAgICAgIHJldHVybiBpbWFnZU5hdHVyYWxXaWR0aCA+IHdpbmRvd1dpZHRoIHx8IGltYWdlTmF0dXJhbEhlaWdodCA+IHdpbmRvd0hlaWdodDtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgaXNGaXJzdEltYWdlKCl7XHJcbiAgICAgICAgaWYgKHRoaXMucHJvcGVydGllcy5sb29wKXtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmluZGV4ID09PSAwO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXQgaXNMYXN0SW1hZ2UoKXtcclxuICAgICAgICBpZiAodGhpcy5wcm9wZXJ0aWVzLmxvb3Ape1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5kZXggPT09IHRoaXMubGF0ZXN0SW1hZ2VJbmRleDtcclxuICAgICAgICB9ICAgICAgICBcclxuICAgIH1cclxuXHJcbiAgICBnZXQgbGF0ZXN0SW1hZ2VJbmRleCgpe1xyXG4gICAgICAgIHJldHVybiB0aGlzLmltYWdlcy5sZW5ndGggLSAxO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBiYWNrZ3JvdW5kQ29sb3IoKXtcclxuICAgICAgICBjb25zdCBvcGFjaXR5ID0gdGhpcy5wcm9wZXJ0aWVzLmJhY2tncm91bmRPcGFjaXR5O1xyXG4gICAgICAgIGNvbnN0IGNvbG9yID0gdGhpcy5wcm9wZXJ0aWVzLmJhY2tncm91bmRDb2xvcjtcclxuICAgICAgICBpZiAoY29sb3IgPT09ICdibGFjaycpIHtcclxuICAgICAgICAgICAgcmV0dXJuICdyZ2JhKDAsIDAsIDAsICcgKyBvcGFjaXR5ICsnKSc7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuICdyZ2JhKDI1NSwgMjU1LCAyNTUsICcgKyBvcGFjaXR5ICsnKSc7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldCBhbmltYXRpb25EdXJhdGlvbigpe1xyXG4gICAgICAgIGNvbnN0IGFuaW1hdGlvbkR1cmF0aW9uID0gdGhpcy5wcm9wZXJ0aWVzLmFuaW1hdGlvbkR1cmF0aW9uO1xyXG5cclxuICAgICAgICBpZiAodHlwZW9mIGFuaW1hdGlvbkR1cmF0aW9uID09PSBcInN0cmluZ1wiKXtcclxuICAgICAgICAgICAgcmV0dXJuIE51bWJlci5wYXJzZUludChhbmltYXRpb25EdXJhdGlvbik7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIGFuaW1hdGlvbkR1cmF0aW9uO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXQgYW5pbWF0aW9uTW9kZSgpe1xyXG4gICAgICAgIGlmICh0aGlzLmN1cnJJbWFnZUxvYWRpbmdTdGF0ZSA9PT0gJ2Vycm9yJyl7XHJcbiAgICAgICAgICAgIHJldHVybiAnZGVmYXVsdCc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLnByb3BlcnRpZXMuYW5pbWF0aW9uTW9kZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgYW5pbWF0aW9uVGltaW5nRnVuY3Rpb24oKXtcclxuICAgICAgICByZXR1cm4gdGhpcy5wcm9wZXJ0aWVzLmFuaW1hdGlvblRpbWluZ0Z1bmN0aW9uO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBjbG9zZUJ1dHRvblRleHQoKXtcclxuICAgICAgICByZXR1cm4gdGhpcy5wcm9wZXJ0aWVzLmNsb3NlQnV0dG9uVGV4dDtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgY291bnRlclNlcGFyYXRvcigpe1xyXG4gICAgICAgIHJldHVybiB0aGlzLnByb3BlcnRpZXMuY291bnRlclNlcGFyYXRvcjtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgY291bnRlcigpe1xyXG4gICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRJbWFnZUluZGV4ICsgMSArIHRoaXMuY291bnRlclNlcGFyYXRvciArIHRoaXMuaW1hZ2VzLmxlbmd0aDtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgZXZlbnRTZXJ2aWNlOiBFdmVudFNlcnZpY2Upe1xyXG4gICAgICAgIHRoaXMuaXNNb2JpbGUgPSBVdGlscy5tb2JpbGVDaGVjaygpO1xyXG4gICAgfVxyXG5cclxuICAgIGVtaXRTdGF0ZSh0eXBlLCBzdGF0ZSl7XHJcbiAgICAgICAgaWYgKHN0YXRlID09PSAnaW5pdGlhbC12aXJ0dWFsLWltYWdlJyB8fCBcclxuICAgICAgICAgICAgc3RhdGUgPT09ICdpbml0aWFsLXN0eWxlcycpe1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoc3RhdGUgPT09ICdpbml0aWFsLWRlZmF1bHQnIHx8IFxyXG4gICAgICAgICAgICBzdGF0ZSA9PT0gJ2luaXRpYWwtdGh1bWJuYWlsLWltYWdlJyl7XHJcbiAgICAgICAgICAgIHN0YXRlID0gJ2luaXRpYWwnO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5ldmVudFNlcnZpY2UuZW1pdENoYW5nZUV2ZW50KHtcclxuICAgICAgICAgICAgdHlwZTogdHlwZSsnOicrc3RhdGVcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRTaG93U3RhdGUoc3RhdGU6IFNob3dTdGF0ZSl7XHJcbiAgICAgICAgdGhpcy5zaG93U3RhdGUgPSBzdGF0ZTtcclxuICAgICAgICB0aGlzLmVtaXRTdGF0ZSgnc2hvdy1zdGF0ZScsIHN0YXRlKVxyXG4gICAgfVxyXG5cclxuICAgIHNldENsb3NpbmdTdGF0ZShzdGF0ZTogQ2xvc2luZ1N0YXRlKXtcclxuICAgICAgICB0aGlzLmNsb3NpbmdTdGF0ZSA9IHN0YXRlOyBcclxuICAgICAgICB0aGlzLmVtaXRTdGF0ZSgnY2xvc2luZy1zdGF0ZScsIHN0YXRlKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRBbmltYXRpb25EdXJhdGlvbigpe1xyXG4gICAgICAgIHRoaXMuaG9zdFN0eWxlVHJhbnNpdGlvbiA9ICdiYWNrZ3JvdW5kLWNvbG9yICcrdGhpcy5hbmltYXRpb25EdXJhdGlvbisnbXMnO1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyU3R5bGVzLnRyYW5zaXRpb24gPSAnYWxsICcrdGhpcy5hbmltYXRpb25EdXJhdGlvbisnbXMgJyt0aGlzLmFuaW1hdGlvblRpbWluZ0Z1bmN0aW9uO1xyXG4gICAgfVxyXG5cclxuICAgIHNldEJhY2tncm91bmRDb2xvcigpe1xyXG4gICAgICAgIHRoaXMuaG9zdFN0eWxlQmFja2dyb3VuZENvbG9yID0gdGhpcy5iYWNrZ3JvdW5kQ29sb3I7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0Q29udGFpbmVySGVpZ2h0KCk6c3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy50aHVtYm5haWxJbWFnZVBvc2l0aW9uLmhlaWdodCAvIHRoaXMuY29udGFpbmVyU2NhbGUgKyAncHgnO1xyXG4gICAgfVxyXG5cclxuICAgIHNob3dUaHVtYm5haWxJbWFnZSgpIHtcclxuICAgICAgICB0aGlzLnRodW1ibmFpbEltYWdlLnN0eWxlLm9wYWNpdHkgPSAnJztcclxuICAgIH1cclxuXHJcbiAgICBoaWRlVGh1bWJuYWlsSW1hZ2UoKXtcclxuICAgICAgICB0aGlzLnRodW1ibmFpbEltYWdlLnN0eWxlLm9wYWNpdHkgPSAwO1xyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZVRodW1ibmFpbFBvc2l0aW9uKCl7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXJTdHlsZXMudHJhbnNmb3JtID0gdGhpcy5jb250YWluZXJJbml0aWFsUG9zaXRpb247XHJcbiAgICB9XHJcbn0gXHJcbiJdfQ==