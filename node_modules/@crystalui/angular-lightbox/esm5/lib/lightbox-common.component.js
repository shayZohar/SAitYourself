/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, HostBinding, ViewChild, ElementRef } from '@angular/core';
import { EventService } from './event.service';
import { Utils } from './utils';
var LightboxCommonComponent = /** @class */ (function () {
    function LightboxCommonComponent(eventService) {
        this.eventService = eventService;
        this.currentImageIndex = 0;
        this.indexCurrentSlide = 1;
        this.containerStyles = {
            transition: '',
            transform: '',
            width: '',
            height: '',
            opacity: ''
        };
        this.currImageLoadingState = 'not-loaded';
        this.isMobile = Utils.mobileCheck();
    }
    Object.defineProperty(LightboxCommonComponent.prototype, "lightboxImage", {
        get: /**
         * @return {?}
         */
        function () {
            return this._lightboxImage;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LightboxCommonComponent.prototype, "lightboxImageElement", {
        get: /**
         * @return {?}
         */
        function () {
            if (this.lightboxImage) {
                return this.lightboxImage.nativeElement;
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LightboxCommonComponent.prototype, "lightboxImageNaturalHeight", {
        get: /**
         * @return {?}
         */
        function () {
            if (this.lightboxImageElement) {
                return this.lightboxImageElement.naturalHeight;
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LightboxCommonComponent.prototype, "lightboxImageNaturalWidth", {
        get: /**
         * @return {?}
         */
        function () {
            if (this.lightboxImageElement) {
                return this.lightboxImageElement.naturalWidth;
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LightboxCommonComponent.prototype, "index", {
        get: /**
         * @return {?}
         */
        function () {
            return this.currentImageIndex;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LightboxCommonComponent.prototype, "properties", {
        get: /**
         * @return {?}
         */
        function () {
            return this.lightboxData.properties;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LightboxCommonComponent.prototype, "images", {
        get: /**
         * @return {?}
         */
        function () {
            return this.lightboxData.images || [this.lightboxData.image];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LightboxCommonComponent.prototype, "thumbnailImage", {
        get: /**
         * @return {?}
         */
        function () {
            return this.images[this.currentImageIndex].nativeElement;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LightboxCommonComponent.prototype, "thumbnailImagePosition", {
        get: /**
         * @return {?}
         */
        function () {
            return this.thumbnailImage.getBoundingClientRect();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LightboxCommonComponent.prototype, "virtualImageDimension", {
        // Image size if it is larger than the window size
        get: 
        // Image size if it is larger than the window size
        /**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var height = this.lightboxImageNaturalHeight;
            /** @type {?} */
            var width = height * this.imageAspectRatio;
            /** @type {?} */
            var windowWidth = document.body.clientWidth;
            /** @type {?} */
            var windowHeight = window.innerHeight;
            if (this.isImageLargerWindow) {
                if (height > windowHeight) {
                    height = windowHeight;
                    width = height * this.imageAspectRatio;
                }
                if (width > windowWidth) {
                    width = windowWidth;
                    height = width / this.imageAspectRatio;
                }
            }
            else {
                width = this.lightboxImageNaturalWidth;
                height = this.lightboxImageNaturalHeight;
            }
            if (width === 0 || Number.parseInt(height) === 0) {
                return { width: 200, height: 200 };
            }
            return { width: width, height: height };
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LightboxCommonComponent.prototype, "containerInitialPosition", {
        get: /**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var scale = (this.showState === 'initial-thumbnail-image') ? 1 : this.containerScale;
            /** @type {?} */
            var top = this.thumbnailImagePosition.top;
            /** @type {?} */
            var left = this.thumbnailImagePosition.left;
            return 'matrix(' + scale + ', 0, 0, ' + scale + ',' + left + ',' + top + ')';
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LightboxCommonComponent.prototype, "containerFullscreenPosition", {
        get: /**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var left = (document.body.clientWidth - this.virtualImageDimension.width) / 2;
            /** @type {?} */
            var top = (window.innerHeight - this.virtualImageDimension.height) / 2;
            return 'translate3d(' + left + 'px, ' + top + 'px, 0)';
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LightboxCommonComponent.prototype, "containerScale", {
        get: /**
         * @return {?}
         */
        function () {
            return this.thumbnailImagePosition.width / this.virtualImageDimension.width;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LightboxCommonComponent.prototype, "imageAspectRatio", {
        get: /**
         * @return {?}
         */
        function () {
            return this.thumbnailImage.naturalWidth / this.thumbnailImage.naturalHeight;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LightboxCommonComponent.prototype, "isImageLargerWindow", {
        get: /**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var imageNaturalWidth = this.lightboxImageNaturalWidth;
            /** @type {?} */
            var imageNaturalHeight = this.lightboxImageNaturalHeight;
            /** @type {?} */
            var windowWidth = document.body.clientWidth;
            /** @type {?} */
            var windowHeight = window.innerHeight;
            return imageNaturalWidth > windowWidth || imageNaturalHeight > windowHeight;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LightboxCommonComponent.prototype, "isFirstImage", {
        get: /**
         * @return {?}
         */
        function () {
            if (this.properties.loop) {
                return false;
            }
            else {
                return this.index === 0;
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LightboxCommonComponent.prototype, "isLastImage", {
        get: /**
         * @return {?}
         */
        function () {
            if (this.properties.loop) {
                return false;
            }
            else {
                return this.index === this.latestImageIndex;
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LightboxCommonComponent.prototype, "latestImageIndex", {
        get: /**
         * @return {?}
         */
        function () {
            return this.images.length - 1;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LightboxCommonComponent.prototype, "backgroundColor", {
        get: /**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var opacity = this.properties.backgroundOpacity;
            /** @type {?} */
            var color = this.properties.backgroundColor;
            if (color === 'black') {
                return 'rgba(0, 0, 0, ' + opacity + ')';
            }
            else {
                return 'rgba(255, 255, 255, ' + opacity + ')';
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LightboxCommonComponent.prototype, "animationDuration", {
        get: /**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var animationDuration = this.properties.animationDuration;
            if (typeof animationDuration === "string") {
                return Number.parseInt(animationDuration);
            }
            else {
                return animationDuration;
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LightboxCommonComponent.prototype, "animationMode", {
        get: /**
         * @return {?}
         */
        function () {
            if (this.currImageLoadingState === 'error') {
                return 'default';
            }
            return this.properties.animationMode;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LightboxCommonComponent.prototype, "animationTimingFunction", {
        get: /**
         * @return {?}
         */
        function () {
            return this.properties.animationTimingFunction;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LightboxCommonComponent.prototype, "closeButtonText", {
        get: /**
         * @return {?}
         */
        function () {
            return this.properties.closeButtonText;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LightboxCommonComponent.prototype, "counterSeparator", {
        get: /**
         * @return {?}
         */
        function () {
            return this.properties.counterSeparator;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LightboxCommonComponent.prototype, "counter", {
        get: /**
         * @return {?}
         */
        function () {
            return this.currentImageIndex + 1 + this.counterSeparator + this.images.length;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} type
     * @param {?} state
     * @return {?}
     */
    LightboxCommonComponent.prototype.emitState = /**
     * @param {?} type
     * @param {?} state
     * @return {?}
     */
    function (type, state) {
        if (state === 'initial-virtual-image' ||
            state === 'initial-styles') {
            return;
        }
        if (state === 'initial-default' ||
            state === 'initial-thumbnail-image') {
            state = 'initial';
        }
        this.eventService.emitChangeEvent({
            type: type + ':' + state
        });
    };
    /**
     * @param {?} state
     * @return {?}
     */
    LightboxCommonComponent.prototype.setShowState = /**
     * @param {?} state
     * @return {?}
     */
    function (state) {
        this.showState = state;
        this.emitState('show-state', state);
    };
    /**
     * @param {?} state
     * @return {?}
     */
    LightboxCommonComponent.prototype.setClosingState = /**
     * @param {?} state
     * @return {?}
     */
    function (state) {
        this.closingState = state;
        this.emitState('closing-state', state);
    };
    /**
     * @return {?}
     */
    LightboxCommonComponent.prototype.setAnimationDuration = /**
     * @return {?}
     */
    function () {
        this.hostStyleTransition = 'background-color ' + this.animationDuration + 'ms';
        this.containerStyles.transition = 'all ' + this.animationDuration + 'ms ' + this.animationTimingFunction;
    };
    /**
     * @return {?}
     */
    LightboxCommonComponent.prototype.setBackgroundColor = /**
     * @return {?}
     */
    function () {
        this.hostStyleBackgroundColor = this.backgroundColor;
    };
    /**
     * @return {?}
     */
    LightboxCommonComponent.prototype.getContainerHeight = /**
     * @return {?}
     */
    function () {
        return this.thumbnailImagePosition.height / this.containerScale + 'px';
    };
    /**
     * @return {?}
     */
    LightboxCommonComponent.prototype.showThumbnailImage = /**
     * @return {?}
     */
    function () {
        this.thumbnailImage.style.opacity = '';
    };
    /**
     * @return {?}
     */
    LightboxCommonComponent.prototype.hideThumbnailImage = /**
     * @return {?}
     */
    function () {
        this.thumbnailImage.style.opacity = 0;
    };
    /**
     * @return {?}
     */
    LightboxCommonComponent.prototype.updateThumbnailPosition = /**
     * @return {?}
     */
    function () {
        this.containerStyles.transform = this.containerInitialPosition;
    };
    LightboxCommonComponent.decorators = [
        { type: Component, args: [{
                    selector: 'lightbox-common',
                    template: ''
                }] }
    ];
    /** @nocollapse */
    LightboxCommonComponent.ctorParameters = function () { return [
        { type: EventService }
    ]; };
    LightboxCommonComponent.propDecorators = {
        lightboxData: [{ type: Input }],
        hostStyleBackgroundColor: [{ type: HostBinding, args: ['style.backgroundColor',] }],
        hostStyleTransition: [{ type: HostBinding, args: ['style.transition',] }],
        _imageFirst: [{ type: ViewChild, args: ['imageFirst',] }],
        _imageSecond: [{ type: ViewChild, args: ['imageSecond',] }],
        _imageLast: [{ type: ViewChild, args: ['imageLast',] }],
        _lightboxImage: [{ type: ViewChild, args: ['lightboxImage',] }]
    };
    return LightboxCommonComponent;
}());
export { LightboxCommonComponent };
if (false) {
    /** @type {?} */
    LightboxCommonComponent.prototype.currentImageIndex;
    /** @type {?} */
    LightboxCommonComponent.prototype.indexCurrentSlide;
    /** @type {?} */
    LightboxCommonComponent.prototype.showState;
    /** @type {?} */
    LightboxCommonComponent.prototype.closingState;
    /** @type {?} */
    LightboxCommonComponent.prototype.containerStyles;
    /** @type {?} */
    LightboxCommonComponent.prototype.currImageLoadingState;
    /** @type {?} */
    LightboxCommonComponent.prototype.isMobile;
    /** @type {?} */
    LightboxCommonComponent.prototype.lightboxData;
    /** @type {?} */
    LightboxCommonComponent.prototype.hostStyleBackgroundColor;
    /** @type {?} */
    LightboxCommonComponent.prototype.hostStyleTransition;
    /** @type {?} */
    LightboxCommonComponent.prototype._imageFirst;
    /** @type {?} */
    LightboxCommonComponent.prototype._imageSecond;
    /** @type {?} */
    LightboxCommonComponent.prototype._imageLast;
    /** @type {?} */
    LightboxCommonComponent.prototype._lightboxImage;
    /** @type {?} */
    LightboxCommonComponent.prototype.eventService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlnaHRib3gtY29tbW9uLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BjcnlzdGFsdWkvYW5ndWxhci1saWdodGJveC8iLCJzb3VyY2VzIjpbImxpYi9saWdodGJveC1jb21tb24uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxXQUFXLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUdyRixPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDL0MsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLFNBQVMsQ0FBQztBQUVoQztJQW1NSSxpQ0FBbUIsWUFBMEI7UUFBMUIsaUJBQVksR0FBWixZQUFZLENBQWM7UUE1TDdDLHNCQUFpQixHQUFXLENBQUMsQ0FBQztRQUM5QixzQkFBaUIsR0FBRyxDQUFDLENBQUM7UUFHdEIsb0JBQWUsR0FBUTtZQUNuQixVQUFVLEVBQUUsRUFBRTtZQUNkLFNBQVMsRUFBRSxFQUFFO1lBQ2IsS0FBSyxFQUFFLEVBQUU7WUFDVCxNQUFNLEVBQUUsRUFBRTtZQUNWLE9BQU8sRUFBRSxFQUFFO1NBQ2QsQ0FBQztRQUNGLDBCQUFxQixHQUFvRCxZQUFZLENBQUM7UUFrTGxGLElBQUksQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQ3hDLENBQUM7SUF0S0Qsc0JBQUksa0RBQWE7Ozs7UUFBakI7WUFDSSxPQUFPLElBQUksQ0FBQyxjQUFjLENBQUM7UUFDL0IsQ0FBQzs7O09BQUE7SUFFRCxzQkFBSSx5REFBb0I7Ozs7UUFBeEI7WUFDSSxJQUFJLElBQUksQ0FBQyxhQUFhLEVBQUM7Z0JBQ25CLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUM7YUFDM0M7UUFDTCxDQUFDOzs7T0FBQTtJQUVELHNCQUFJLCtEQUEwQjs7OztRQUE5QjtZQUNJLElBQUks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VyxTQUFDLGtCQUFrQjs4QkFFOUIsU0FBUyxTQUFDLFlBQVk7K0JBQ3RCLFNBQVMsU0FBQyxhQUFhOzZCQUN2QixTQUFTLFNBQUMsV0FBVztpQ0FDckIsU0FBUyxTQUFDLGVBQWU7O0lBNE45Qiw4QkFBQztDQUFBLEFBelBELElBeVBDO1NBcFBZLHVCQUF1Qjs7O0lBRWhDLG9EQUE4Qjs7SUFDOUIsb0RBQXNCOztJQUN0Qiw0Q0FBcUI7O0lBQ3JCLCtDQUEyQjs7SUFDM0Isa0RBTUU7O0lBQ0Ysd0RBQXNGOztJQUN0RiwyQ0FBa0I7O0lBRWxCLCtDQUFvQzs7SUFFcEMsMkRBQXVFOztJQUN2RSxzREFBNkQ7O0lBRTdELDhDQUFpRDs7SUFDakQsK0NBQW1EOztJQUNuRCw2Q0FBK0M7O0lBQy9DLGlEQUF1RDs7SUFzSzNDLCtDQUFpQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIEhvc3RCaW5kaW5nLCBWaWV3Q2hpbGQsIEVsZW1lbnRSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgTGlnaHRib3hEYXRhLCBQcm9wZXJ0aWVzIH0gZnJvbSAnLi9pbnRlcmZhY2VzJztcclxuaW1wb3J0IHsgU2hvd1N0YXRlLCBDbG9zaW5nU3RhdGUgfSBmcm9tICcuL3R5cGVzJztcclxuaW1wb3J0IHsgRXZlbnRTZXJ2aWNlIH0gZnJvbSAnLi9ldmVudC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgVXRpbHMgfSBmcm9tICcuL3V0aWxzJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdsaWdodGJveC1jb21tb24nLFxyXG4gICAgdGVtcGxhdGU6ICcnXHJcbn0pXHJcblxyXG5leHBvcnQgY2xhc3MgTGlnaHRib3hDb21tb25Db21wb25lbnQge1xyXG5cclxuICAgIGN1cnJlbnRJbWFnZUluZGV4OiBudW1iZXIgPSAwO1xyXG4gICAgaW5kZXhDdXJyZW50U2xpZGUgPSAxO1xyXG4gICAgc2hvd1N0YXRlOiBTaG93U3RhdGU7XHJcbiAgICBjbG9zaW5nU3RhdGU6IENsb3NpbmdTdGF0ZTtcclxuICAgIGNvbnRhaW5lclN0eWxlczogYW55ID0ge1xyXG4gICAgICAgIHRyYW5zaXRpb246ICcnLFxyXG4gICAgICAgIHRyYW5zZm9ybTogJycsXHJcbiAgICAgICAgd2lkdGg6ICcnLFxyXG4gICAgICAgIGhlaWdodDogJycsXHJcbiAgICAgICAgb3BhY2l0eTogJydcclxuICAgIH07XHJcbiAgICBjdXJySW1hZ2VMb2FkaW5nU3RhdGU6ICdub3QtbG9hZGVkJyB8ICdsb2FkaW5nJyB8ICd1cGxvYWRlZCcgfCAnZXJyb3InID0gJ25vdC1sb2FkZWQnO1xyXG4gICAgaXNNb2JpbGU6IGJvb2xlYW47XHJcblxyXG4gICAgQElucHV0KCkgbGlnaHRib3hEYXRhOiBMaWdodGJveERhdGE7XHJcblxyXG4gICAgQEhvc3RCaW5kaW5nKCdzdHlsZS5iYWNrZ3JvdW5kQ29sb3InKSBob3N0U3R5bGVCYWNrZ3JvdW5kQ29sb3I6IHN0cmluZztcclxuICAgIEBIb3N0QmluZGluZygnc3R5bGUudHJhbnNpdGlvbicpIGhvc3RTdHlsZVRyYW5zaXRpb246IHN0cmluZztcclxuXHJcbiAgICBAVmlld0NoaWxkKCdpbWFnZUZpcnN0JykgX2ltYWdlRmlyc3Q6IEVsZW1lbnRSZWY7XHJcbiAgICBAVmlld0NoaWxkKCdpbWFnZVNlY29uZCcpIF9pbWFnZVNlY29uZDogRWxlbWVudFJlZjtcclxuICAgIEBWaWV3Q2hpbGQoJ2ltYWdlTGFzdCcpIF9pbWFnZUxhc3Q6IEVsZW1lbnRSZWY7XHJcbiAgICBAVmlld0NoaWxkKCdsaWdodGJveEltYWdlJykgX2xpZ2h0Ym94SW1hZ2U6IEVsZW1lbnRSZWY7XHJcblxyXG4gICAgZ2V0IGxpZ2h0Ym94SW1hZ2UoKXtcclxuICAgICAgICByZXR1cm4gdGhpcy5fbGlnaHRib3hJbWFnZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgbGlnaHRib3hJbWFnZUVsZW1lbnQoKXtcclxuICAgICAgICBpZiAodGhpcy5saWdodGJveEltYWdlKXtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMubGlnaHRib3hJbWFnZS5uYXRpdmVFbGVtZW50O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXQgbGlnaHRib3hJbWFnZU5hdHVyYWxIZWlnaHQoKXtcclxuICAgICAgICBpZiAodGhpcy5saWdodGJveEltYWdlRWxlbWVudCl7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmxpZ2h0Ym94SW1hZ2VFbGVtZW50Lm5hdHVyYWxIZWlnaHQ7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldCBsaWdodGJveEltYWdlTmF0dXJhbFdpZHRoKCl7XHJcbiAgICAgICAgaWYgKHRoaXMubGlnaHRib3hJbWFnZUVsZW1lbnQpe1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5saWdodGJveEltYWdlRWxlbWVudC5uYXR1cmFsV2lkdGg7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldCBpbmRleCgpe1xyXG4gICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRJbWFnZUluZGV4O1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBwcm9wZXJ0aWVzKCl7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubGlnaHRib3hEYXRhLnByb3BlcnRpZXM7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGltYWdlcygpe1xyXG4gICAgICAgIHJldHVybiB0aGlzLmxpZ2h0Ym94RGF0YS5pbWFnZXMgfHwgW3RoaXMubGlnaHRib3hEYXRhLmltYWdlXTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgdGh1bWJuYWlsSW1hZ2UoKXtcclxuICAgICAgICByZXR1cm4gdGhpcy5pbWFnZXNbdGhpcy5jdXJyZW50SW1hZ2VJbmRleF0ubmF0aXZlRWxlbWVudDtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgdGh1bWJuYWlsSW1hZ2VQb3NpdGlvbigpe1xyXG4gICAgICAgIHJldHVybiB0aGlzLnRodW1ibmFpbEltYWdlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEltYWdlIHNpemUgaWYgaXQgaXMgbGFyZ2VyIHRoYW4gdGhlIHdpbmRvdyBzaXplXHJcbiAgICBnZXQgdmlydHVhbEltYWdlRGltZW5zaW9uKCl7XHJcbiAgICAgICAgbGV0IGhlaWdodCA9IHRoaXMubGlnaHRib3hJbWFnZU5hdHVyYWxIZWlnaHQ7XHJcbiAgICAgICAgbGV0IHdpZHRoID0gaGVpZ2h0ICogdGhpcy5pbWFnZUFzcGVjdFJhdGlvO1xyXG4gICAgICAgIGNvbnN0IHdpbmRvd1dpZHRoID0gZG9jdW1lbnQuYm9keS5jbGllbnRXaWR0aDtcclxuICAgICAgICBjb25zdCB3aW5kb3dIZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmlzSW1hZ2VMYXJnZXJXaW5kb3cpe1xyXG4gICAgICAgICAgICBpZiAoaGVpZ2h0ID4gd2luZG93SGVpZ2h0KXtcclxuICAgICAgICAgICAgICAgIGhlaWdodCA9IHdpbmRvd0hlaWdodDtcclxuICAgICAgICAgICAgICAgIHdpZHRoID0gaGVpZ2h0ICogdGhpcy5pbWFnZUFzcGVjdFJhdGlvO1xyXG4gICAgICAgICAgICB9IFxyXG5cclxuICAgICAgICAgICAgaWYgKHdpZHRoID4gd2luZG93V2lkdGgpe1xyXG4gICAgICAgICAgICAgICAgd2lkdGggPSB3aW5kb3dXaWR0aDtcclxuICAgICAgICAgICAgICAgIGhlaWdodCA9IHdpZHRoIC8gdGhpcy5pbWFnZUFzcGVjdFJhdGlvO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgd2lkdGggPSB0aGlzLmxpZ2h0Ym94SW1hZ2VOYXR1cmFsV2lkdGg7XHJcbiAgICAgICAgICAgIGhlaWdodCA9IHRoaXMubGlnaHRib3hJbWFnZU5hdHVyYWxIZWlnaHQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAod2lkdGggPT09IDAgfHwgTnVtYmVyLnBhcnNlSW50KGhlaWdodCkgPT09IDApe1xyXG4gICAgICAgICAgICByZXR1cm4ge3dpZHRoOiAyMDAsIGhlaWdodDogMjAwfTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB7d2lkdGgsIGhlaWdodH07XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGNvbnRhaW5lckluaXRpYWxQb3NpdGlvbigpe1xyXG4gICAgICAgIGNvbnN0IHNjYWxlID0gICh0aGlzLnNob3dTdGF0ZSA9PT0gJ2luaXRpYWwtdGh1bWJuYWlsLWltYWdlJykgPyAxIDogdGhpcy5jb250YWluZXJTY2FsZTsgXHJcbiAgICAgICAgY29uc3QgdG9wID0gdGhpcy50aHVtYm5haWxJbWFnZVBvc2l0aW9uLnRvcDtcclxuICAgICAgICBjb25zdCBsZWZ0ID0gdGhpcy50aHVtYm5haWxJbWFnZVBvc2l0aW9uLmxlZnQ7XHJcbiAgICAgICAgcmV0dXJuICdtYXRyaXgoJysgc2NhbGUgKycsIDAsIDAsICcrIHNjYWxlICsnLCcrIGxlZnQgKycsJysgdG9wICsnKSc7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGNvbnRhaW5lckZ1bGxzY3JlZW5Qb3NpdGlvbigpe1xyXG4gICAgICAgIGNvbnN0IGxlZnQgPSAoZG9jdW1lbnQuYm9keS5jbGllbnRXaWR0aCAtIHRoaXMudmlydHVhbEltYWdlRGltZW5zaW9uLndpZHRoKSAvIDI7XHJcbiAgICAgICAgY29uc3QgdG9wID0gKHdpbmRvdy5pbm5lckhlaWdodCAtIHRoaXMudmlydHVhbEltYWdlRGltZW5zaW9uLmhlaWdodCkgLyAyO1xyXG5cclxuICAgICAgICByZXR1cm4gJ3RyYW5zbGF0ZTNkKCcrIGxlZnQgKydweCwgJysgdG9wICsncHgsIDApJztcclxuICAgIH1cclxuXHJcbiAgICBnZXQgY29udGFpbmVyU2NhbGUoKXtcclxuICAgICAgICByZXR1cm4gdGhpcy50aHVtYm5haWxJbWFnZVBvc2l0aW9uLndpZHRoIC8gdGhpcy52aXJ0dWFsSW1hZ2VEaW1lbnNpb24ud2lkdGg7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGltYWdlQXNwZWN0UmF0aW8oKXtcclxuICAgICAgICByZXR1cm4gdGhpcy50aHVtYm5haWxJbWFnZS5uYXR1cmFsV2lkdGggLyB0aGlzLnRodW1ibmFpbEltYWdlLm5hdHVyYWxIZWlnaHQ7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGlzSW1hZ2VMYXJnZXJXaW5kb3coKTpib29sZWFuIHtcclxuICAgICAgICBjb25zdCBpbWFnZU5hdHVyYWxXaWR0aCA9IHRoaXMubGlnaHRib3hJbWFnZU5hdHVyYWxXaWR0aDtcclxuICAgICAgICBjb25zdCBpbWFnZU5hdHVyYWxIZWlnaHQgPSB0aGlzLmxpZ2h0Ym94SW1hZ2VOYXR1cmFsSGVpZ2h0O1xyXG4gICAgICAgIGNvbnN0IHdpbmRvd1dpZHRoID0gZG9jdW1lbnQuYm9keS5jbGllbnRXaWR0aDtcclxuICAgICAgICBjb25zdCB3aW5kb3dIZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XHJcbiAgICAgICAgcmV0dXJuIGltYWdlTmF0dXJhbFdpZHRoID4gd2luZG93V2lkdGggfHwgaW1hZ2VOYXR1cmFsSGVpZ2h0ID4gd2luZG93SGVpZ2h0O1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBpc0ZpcnN0SW1hZ2UoKXtcclxuICAgICAgICBpZiAodGhpcy5wcm9wZXJ0aWVzLmxvb3Ape1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5kZXggPT09IDA7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldCBpc0xhc3RJbWFnZSgpe1xyXG4gICAgICAgIGlmICh0aGlzLnByb3BlcnRpZXMubG9vcCl7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5pbmRleCA9PT0gdGhpcy5sYXRlc3RJbWFnZUluZGV4O1xyXG4gICAgICAgIH0gICAgICAgIFxyXG4gICAgfVxyXG5cclxuICAgIGdldCBsYXRlc3RJbWFnZUluZGV4KCl7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaW1hZ2VzLmxlbmd0aCAtIDE7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGJhY2tncm91bmRDb2xvcigpe1xyXG4gICAgICAgIGNvbnN0IG9wYWNpdHkgPSB0aGlzLnByb3BlcnRpZXMuYmFja2dyb3VuZE9wYWNpdHk7XHJcbiAgICAgICAgY29uc3QgY29sb3IgPSB0aGlzLnByb3BlcnRpZXMuYmFja2dyb3VuZENvbG9yO1xyXG4gICAgICAgIGlmIChjb2xvciA9PT0gJ2JsYWNrJykge1xyXG4gICAgICAgICAgICByZXR1cm4gJ3JnYmEoMCwgMCwgMCwgJyArIG9wYWNpdHkgKycpJztcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gJ3JnYmEoMjU1LCAyNTUsIDI1NSwgJyArIG9wYWNpdHkgKycpJztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGFuaW1hdGlvbkR1cmF0aW9uKCl7XHJcbiAgICAgICAgY29uc3QgYW5pbWF0aW9uRHVyYXRpb24gPSB0aGlzLnByb3BlcnRpZXMuYW5pbWF0aW9uRHVyYXRpb247XHJcblxyXG4gICAgICAgIGlmICh0eXBlb2YgYW5pbWF0aW9uRHVyYXRpb24gPT09IFwic3RyaW5nXCIpe1xyXG4gICAgICAgICAgICByZXR1cm4gTnVtYmVyLnBhcnNlSW50KGFuaW1hdGlvbkR1cmF0aW9uKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gYW5pbWF0aW9uRHVyYXRpb247XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldCBhbmltYXRpb25Nb2RlKCl7XHJcbiAgICAgICAgaWYgKHRoaXMuY3VyckltYWdlTG9hZGluZ1N0YXRlID09PSAnZXJyb3InKXtcclxuICAgICAgICAgICAgcmV0dXJuICdkZWZhdWx0JztcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvcGVydGllcy5hbmltYXRpb25Nb2RlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBhbmltYXRpb25UaW1pbmdGdW5jdGlvbigpe1xyXG4gICAgICAgIHJldHVybiB0aGlzLnByb3BlcnRpZXMuYW5pbWF0aW9uVGltaW5nRnVuY3Rpb247XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGNsb3NlQnV0dG9uVGV4dCgpe1xyXG4gICAgICAgIHJldHVybiB0aGlzLnByb3BlcnRpZXMuY2xvc2VCdXR0b25UZXh0O1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBjb3VudGVyU2VwYXJhdG9yKCl7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvcGVydGllcy5jb3VudGVyU2VwYXJhdG9yO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBjb3VudGVyKCl7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEltYWdlSW5kZXggKyAxICsgdGhpcy5jb3VudGVyU2VwYXJhdG9yICsgdGhpcy5pbWFnZXMubGVuZ3RoO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBldmVudFNlcnZpY2U6IEV2ZW50U2VydmljZSl7XHJcbiAgICAgICAgdGhpcy5pc01vYmlsZSA9IFV0aWxzLm1vYmlsZUNoZWNrKCk7XHJcbiAgICB9XHJcblxyXG4gICAgZW1pdFN0YXRlKHR5cGUsIHN0YXRlKXtcclxuICAgICAgICBpZiAoc3RhdGUgPT09ICdpbml0aWFsLXZpcnR1YWwtaW1hZ2UnIHx8IFxyXG4gICAgICAgICAgICBzdGF0ZSA9PT0gJ2luaXRpYWwtc3R5bGVzJyl7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChzdGF0ZSA9PT0gJ2luaXRpYWwtZGVmYXVsdCcgfHwgXHJcbiAgICAgICAgICAgIHN0YXRlID09PSAnaW5pdGlhbC10aHVtYm5haWwtaW1hZ2UnKXtcclxuICAgICAgICAgICAgc3RhdGUgPSAnaW5pdGlhbCc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmV2ZW50U2VydmljZS5lbWl0Q2hhbmdlRXZlbnQoe1xyXG4gICAgICAgICAgICB0eXBlOiB0eXBlKyc6JytzdGF0ZVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHNldFNob3dTdGF0ZShzdGF0ZTogU2hvd1N0YXRlKXtcclxuICAgICAgICB0aGlzLnNob3dTdGF0ZSA9IHN0YXRlO1xyXG4gICAgICAgIHRoaXMuZW1pdFN0YXRlKCdzaG93LXN0YXRlJywgc3RhdGUpXHJcbiAgICB9XHJcblxyXG4gICAgc2V0Q2xvc2luZ1N0YXRlKHN0YXRlOiBDbG9zaW5nU3RhdGUpe1xyXG4gICAgICAgIHRoaXMuY2xvc2luZ1N0YXRlID0gc3RhdGU7IFxyXG4gICAgICAgIHRoaXMuZW1pdFN0YXRlKCdjbG9zaW5nLXN0YXRlJywgc3RhdGUpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldEFuaW1hdGlvbkR1cmF0aW9uKCl7XHJcbiAgICAgICAgdGhpcy5ob3N0U3R5bGVUcmFuc2l0aW9uID0gJ2JhY2tncm91bmQtY29sb3IgJyt0aGlzLmFuaW1hdGlvbkR1cmF0aW9uKydtcyc7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXJTdHlsZXMudHJhbnNpdGlvbiA9ICdhbGwgJyt0aGlzLmFuaW1hdGlvbkR1cmF0aW9uKydtcyAnK3RoaXMuYW5pbWF0aW9uVGltaW5nRnVuY3Rpb247XHJcbiAgICB9XHJcblxyXG4gICAgc2V0QmFja2dyb3VuZENvbG9yKCl7XHJcbiAgICAgICAgdGhpcy5ob3N0U3R5bGVCYWNrZ3JvdW5kQ29sb3IgPSB0aGlzLmJhY2tncm91bmRDb2xvcjtcclxuICAgIH1cclxuXHJcbiAgICBnZXRDb250YWluZXJIZWlnaHQoKTpzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnRodW1ibmFpbEltYWdlUG9zaXRpb24uaGVpZ2h0IC8gdGhpcy5jb250YWluZXJTY2FsZSArICdweCc7XHJcbiAgICB9XHJcblxyXG4gICAgc2hvd1RodW1ibmFpbEltYWdlKCkge1xyXG4gICAgICAgIHRoaXMudGh1bWJuYWlsSW1hZ2Uuc3R5bGUub3BhY2l0eSA9ICcnO1xyXG4gICAgfVxyXG5cclxuICAgIGhpZGVUaHVtYm5haWxJbWFnZSgpe1xyXG4gICAgICAgIHRoaXMudGh1bWJuYWlsSW1hZ2Uuc3R5bGUub3BhY2l0eSA9IDA7XHJcbiAgICB9XHJcblxyXG4gICAgdXBkYXRlVGh1bWJuYWlsUG9zaXRpb24oKXtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lclN0eWxlcy50cmFuc2Zvcm0gPSB0aGlzLmNvbnRhaW5lckluaXRpYWxQb3NpdGlvbjtcclxuICAgIH1cclxufSBcclxuIl19